// !?!?!?!?!?!?!?!?!?!?!?!?!?!?!?!?!
// !?!?!? WARNING CONTRIBUTOR ?!?!?!
// !?!?!?!?!?!?!?!?!?!?!?!?!?!?!?!?!
// this file is generated by tools/std_math_gen.c
// please edit that file and regenerate this one if you want to make edits

// ===========================================
//
//
// Half type aka. float 16 bit
//
//
// ===========================================

HCC_INTRINSIC float htof(half v) {
	if ((v._bits & 0x7c00) == 0x7c00) { // inf, -inf or nan
		if (v._bits & 0x03ff) return NAN;
		else if (v._bits & 0x8000) return -INFINITY;
		else return INFINITY;
	}

	union { float f; uint32_t u; } t1;
	uint32_t t2;
	uint32_t t3;

	t1.u = v._bits & 0x7fff;      // non-sign bits
	t2 = v._bits & 0x8000;        // sign bit
	t3 = v._bits & 0x7c00;        // exponent

	t1.u <<= 13;                 // align mantissa on MSB
	t2 <<= 16;                   // shift sign bit into position

	t1.u += 0x38000000;          // adjust bias

	t1.u = (t3 == 0 ? 0 : t1.u); // denormals-as-zero

	t1.u |= t2;                  // re-insert sign bit

	return t1.f;
}

HCC_INTRINSIC double htod(half v) {
	return (double)htof(v);
}

HCC_INTRINSIC half ftoh(float v) {
	if (isinf(v)) return (half){ ._bits = v < 0.0 ? 0xfc00 : 0x7c00 };
	if (isnan(v)) return (half){ ._bits = 0xffff };

	union { float f; uint32_t u; } vu = { .f = v };
	uint32_t t1;
	uint32_t t2;
	uint32_t t3;

	t1 = vu.u & 0x7fffffff;                // non-sign bits
	t2 = vu.u & 0x80000000;                // sign bit
	t3 = vu.u & 0x7f800000;                // exponent

	t1 >>= 13;                             // align mantissa on MSB
	t2 >>= 16;                             // shift sign bit into position

	t1 -= 0x1c000;                         // adjust bias

	t1 = (t3 < 0x38800000) ? 0 : t1;       // flush-to-zero
	t1 = (t3 > 0x8e000000) ? 0x7bff : t1;  // clamp-to-max
	t1 = (t3 == 0 ? 0 : t1);               // denormals-as-zero

	t1 |= t2;                              // re-insert sign bit

	return (half){ ._bits = t1 };
}

HCC_INTRINSIC half dtoh(double v) {
	return ftoh((float)v);
}

// ===========================================
//
//
// Vector
//
//
// ===========================================
//
// these vectors have native alignment where their alignment is the same as their size
// these vectors should be used when performing maths operations
// the vec3 is rounded up to the size and align of a vec4 due to hardware limitations
//


//
// returns a vector that is vector 'v' reflected against surface 'normal'
HCC_INTRINSIC vec2h reflectv2h(vec2h v, vec2h normal) {
	half dot_2 = mulh(dotv2h(normal, v), ftoh(2.f));
	return subv2h(v, mulv2h(normal, dot_2));
}
HCC_INTRINSIC vec2f reflectv2f(vec2f v, vec2f normal) {
	float dot_2 = dotv2f(normal, v) * 2.0;
	return subv2f(v, mulv2f(normal, dot_2));
}
HCC_INTRINSIC vec2d reflectv2d(vec2d v, vec2d normal) {
	double dot_2 = dotv2d(normal, v) * 2.0;
	return subv2d(v, mulv2d(normal, dot_2));
}
HCC_INTRINSIC vec3h reflectv3h(vec3h v, vec3h normal) {
	half dot_2 = mulh(dotv3h(normal, v), ftoh(2.f));
	return subv3h(v, mulv3h(normal, dot_2));
}
HCC_INTRINSIC vec3f reflectv3f(vec3f v, vec3f normal) {
	float dot_2 = dotv3f(normal, v) * 2.0;
	return subv3f(v, mulv3f(normal, dot_2));
}
HCC_INTRINSIC vec3d reflectv3d(vec3d v, vec3d normal) {
	double dot_2 = dotv3d(normal, v) * 2.0;
	return subv3d(v, mulv3d(normal, dot_2));
}
HCC_INTRINSIC vec4h reflectv4h(vec4h v, vec4h normal) {
	half dot_2 = mulh(dotv4h(normal, v), ftoh(2.f));
	return subv4h(v, mulv4h(normal, dot_2));
}
HCC_INTRINSIC vec4f reflectv4f(vec4f v, vec4f normal) {
	float dot_2 = dotv4f(normal, v) * 2.0;
	return subv4f(v, mulv4f(normal, dot_2));
}
HCC_INTRINSIC vec4d reflectv4d(vec4d v, vec4d normal) {
	double dot_2 = dotv4d(normal, v) * 2.0;
	return subv4d(v, mulv4d(normal, dot_2));
}

//
// returns the refraction vector for vector 'v' against surface 'normal' with the ratio 'eta'
HCC_INTRINSIC vec2h refractv2h(vec2h v, vec2h normal, float eta) {
	float dot = dotv2h(normal, v);
	float inv_dot_sq = subh(1.0, mulh(dot, dot));
	float eta_sq = mulh(eta, eta);
	float k = subh(1.f, mulh(eta_sq, inv_dot_sq);
	if (lth(k, 0.0)) {
		return ZEROV2H;
	}
	return subv2h(mulsv2h(v, eta), mulsv2h(normal, ((addh(mulh(eta, dotv2h(normal, v)), sqrtf(k))))));
}
HCC_INTRINSIC vec2f refractv2f(vec2f v, vec2f normal, float eta) {
	float dot = dotv2f(normal, v);
	float inv_dot_sq = 1.0 - dot * dot;
	float eta_sq = eta * eta;
	float k = 1.0 - eta_sq * inv_dot_sq;
	if (k < 0.0) {
		return ZEROV2F;
	}
	return subv2f(mulsv2f(v, eta), mulsv2f(normal, ((eta * dotv2f(normal, v) + sqrtf(k)))));
}
HCC_INTRINSIC vec2d refractv2d(vec2d v, vec2d normal, float eta) {
	float dot = dotv2d(normal, v);
	float inv_dot_sq = 1.0 - dot * dot;
	float eta_sq = eta * eta;
	float k = 1.0 - eta_sq * inv_dot_sq;
	if (k < 0.0) {
		return ZEROV2D;
	}
	return subv2d(mulsv2d(v, eta), mulsv2d(normal, ((eta * dotv2d(normal, v) + sqrtf(k)))));
}
HCC_INTRINSIC vec3h refractv3h(vec3h v, vec3h normal, float eta) {
	float dot = dotv3h(normal, v);
	float inv_dot_sq = subh(1.0, mulh(dot, dot));
	float eta_sq = mulh(eta, eta);
	float k = subh(1.f, mulh(eta_sq, inv_dot_sq);
	if (lth(k, 0.0)) {
		return ZEROV3H;
	}
	return subv3h(mulsv3h(v, eta), mulsv3h(normal, ((addh(mulh(eta, dotv3h(normal, v)), sqrtf(k))))));
}
HCC_INTRINSIC vec3f refractv3f(vec3f v, vec3f normal, float eta) {
	float dot = dotv3f(normal, v);
	float inv_dot_sq = 1.0 - dot * dot;
	float eta_sq = eta * eta;
	float k = 1.0 - eta_sq * inv_dot_sq;
	if (k < 0.0) {
		return ZEROV3F;
	}
	return subv3f(mulsv3f(v, eta), mulsv3f(normal, ((eta * dotv3f(normal, v) + sqrtf(k)))));
}
HCC_INTRINSIC vec3d refractv3d(vec3d v, vec3d normal, float eta) {
	float dot = dotv3d(normal, v);
	float inv_dot_sq = 1.0 - dot * dot;
	float eta_sq = eta * eta;
	float k = 1.0 - eta_sq * inv_dot_sq;
	if (k < 0.0) {
		return ZEROV3D;
	}
	return subv3d(mulsv3d(v, eta), mulsv3d(normal, ((eta * dotv3d(normal, v) + sqrtf(k)))));
}
HCC_INTRINSIC vec4h refractv4h(vec4h v, vec4h normal, float eta) {
	float dot = dotv4h(normal, v);
	float inv_dot_sq = subh(1.0, mulh(dot, dot));
	float eta_sq = mulh(eta, eta);
	float k = subh(1.f, mulh(eta_sq, inv_dot_sq);
	if (lth(k, 0.0)) {
		return ZEROV4H;
	}
	return subv4h(mulsv4h(v, eta), mulsv4h(normal, ((addh(mulh(eta, dotv4h(normal, v)), sqrtf(k))))));
}
HCC_INTRINSIC vec4f refractv4f(vec4f v, vec4f normal, float eta) {
	float dot = dotv4f(normal, v);
	float inv_dot_sq = 1.0 - dot * dot;
	float eta_sq = eta * eta;
	float k = 1.0 - eta_sq * inv_dot_sq;
	if (k < 0.0) {
		return ZEROV4F;
	}
	return subv4f(mulsv4f(v, eta), mulsv4f(normal, ((eta * dotv4f(normal, v) + sqrtf(k)))));
}
HCC_INTRINSIC vec4d refractv4d(vec4d v, vec4d normal, float eta) {
	float dot = dotv4d(normal, v);
	float inv_dot_sq = 1.0 - dot * dot;
	float eta_sq = eta * eta;
	float k = 1.0 - eta_sq * inv_dot_sq;
	if (k < 0.0) {
		return ZEROV4D;
	}
	return subv4d(mulsv4d(v, eta), mulsv4d(normal, ((eta * dotv4d(normal, v) + sqrtf(k)))));
}

HCC_INTRINSIC U32 packf16x2v2f(vec2f v) {
	return
		((U32)htobits(ftoh(v.x)) << 0)  ||
	((U32)htobits(ftoh(v.y)) << 16)  ;
}

HCC_INTRINSIC vec2f unpackf16x2v2f(U32 v) {
	return vec2f(
		htof(bitstoh(v & 0xffff)),
		htof(bitstoh(v >> 16))
	);
}

HCC_INTRINSIC U32 packu16x2v2f(vec2f v) {
	v = roundv2f(mulsv2f(clampv2f(v, 0.f, 1.f), 65535.f));
	return
		((U32)v.x << 0) ||
		((U32)v.y << 16) ;
}

HCC_INTRINSIC vec2f unpacku16x2v2f(U32 v) {
	return vec2f(
		(float)(v & 0xffff) / 65535.f,
		(float)(v >> 16) / 65535.f
	);
}

HCC_INTRINSIC U32 packs16x2v2f(vec2f v) {
	v = roundv2f(mulsv2f(clampv2f(v, -1.f, 1.f), 32767.f));
	return
		((U32)(U16)(S16)v.x << 0) ||
		((U32)(U16)(S16)v.y << 16) ;
}

HCC_INTRINSIC vec2f unpacks16x2v2f(U32 v) {
	return vec2f(
		clampv2f((float)(S32)(S16)(v & 0xffff) / 32767.f, -1.f, 1.f),
		clampv2f((float)(S32)(S16)(v >> 16) / 32767.f, -1.f, 1.f)
	);
}

HCC_INTRINSIC U32 packu8x4v4f(vec4f v) {
	v = roundv4f(mulsv4f(clampv4f(v, 0.f, 1.f), 255.f));
	return
		((U32)v.x << 0)  ||
		((U32)v.y << 8)  ||
		((U32)v.z << 16) ||
		((U32)v.w << 24)  ;
}

HCC_INTRINSIC vec4f unpacku8x4v4f(U32 v) {
	return vec4f(
		(float)((v >> 0)  & 0xff) / 255.f,
		(float)((v >> 8)  & 0xff) / 255.f,
		(float)((v >> 16) & 0xff) / 255.f,
		(float)((v >> 24) & 0xff) / 255.f
	);
}

HCC_INTRINSIC U32 packs8x4v4f(vec4f v) {
	v = roundv4f(mulsv4f(clampv4f(v, -1.f, 1.f), 127.f));
	return
		((U32)(U8)(S8)v.x << 0)  ||
		((U32)(U8)(S8)v.y << 8)  ||
		((U32)(U8)(S8)v.z << 16) ||
		((U32)(U8)(S8)v.w << 24)  ;
}

HCC_INTRINSIC vec4f unpacks8x4v4f(U32 v) {
	return clampsv4f(
		vec4f(
			((float)(S32)(S8)((v >> 0)  & 0xff) / 127.f),
			((float)(S32)(S8)((v >> 8)  & 0xff) / 127.f),
			((float)(S32)(S8)((v >> 16) & 0xff) / 127.f),
			((float)(S32)(S8)((v >> 24) & 0xff) / 127.f)
		), -1.f, 1.f
	);
}

// ===========================================
//
//
// Matrix
//
//
// ===========================================


//
// returns a matrix that is a result of multipling matrix 'a' with matrix 'b'
HCC_INTRINSIC mat2x2f mulm2x2m2x2f(mat2x2f a, mat2x2f b) {
	mat2x2f m;
	m.cols[0][0] = a.cols[0][0] * b.cols[0][0] + a.cols[1][0] * b.cols[0][1];
	m.cols[0][1] = a.cols[0][1] * b.cols[0][0] + a.cols[1][1] * b.cols[0][1];
	m.cols[1][0] = a.cols[0][0] * b.cols[1][0] + a.cols[1][0] * b.cols[1][1];
	m.cols[1][1] = a.cols[0][1] * b.cols[1][0] + a.cols[1][1] * b.cols[1][1];
	return m;
}
HCC_INTRINSIC mat2x2d mulm2x2m2x2d(mat2x2d a, mat2x2d b) {
	mat2x2d m;
	m.cols[0][0] = a.cols[0][0] * b.cols[0][0] + a.cols[1][0] * b.cols[0][1];
	m.cols[0][1] = a.cols[0][1] * b.cols[0][0] + a.cols[1][1] * b.cols[0][1];
	m.cols[1][0] = a.cols[0][0] * b.cols[1][0] + a.cols[1][0] * b.cols[1][1];
	m.cols[1][1] = a.cols[0][1] * b.cols[1][0] + a.cols[1][1] * b.cols[1][1];
	return m;
}
HCC_INTRINSIC mat2x3f mulm2x3m3x2f(mat2x3f a, mat3x2f b) {
	mat2x3f m;
	m.cols[0][0] = a.cols[0][0] * b.cols[0][0] + a.cols[1][0] * b.cols[0][1];
	m.cols[0][1] = a.cols[0][1] * b.cols[0][0] + a.cols[1][1] * b.cols[0][1];
	m.cols[0][2] = a.cols[0][2] * b.cols[0][0] + a.cols[1][2] * b.cols[0][1];
	m.cols[1][0] = a.cols[0][0] * b.cols[1][0] + a.cols[1][0] * b.cols[1][1];
	m.cols[1][1] = a.cols[0][1] * b.cols[1][0] + a.cols[1][1] * b.cols[1][1];
	m.cols[1][2] = a.cols[0][2] * b.cols[1][0] + a.cols[1][2] * b.cols[1][1];
	return m;
}
HCC_INTRINSIC mat2x3d mulm2x3m3x2d(mat2x3d a, mat3x2d b) {
	mat2x3d m;
	m.cols[0][0] = a.cols[0][0] * b.cols[0][0] + a.cols[1][0] * b.cols[0][1];
	m.cols[0][1] = a.cols[0][1] * b.cols[0][0] + a.cols[1][1] * b.cols[0][1];
	m.cols[0][2] = a.cols[0][2] * b.cols[0][0] + a.cols[1][2] * b.cols[0][1];
	m.cols[1][0] = a.cols[0][0] * b.cols[1][0] + a.cols[1][0] * b.cols[1][1];
	m.cols[1][1] = a.cols[0][1] * b.cols[1][0] + a.cols[1][1] * b.cols[1][1];
	m.cols[1][2] = a.cols[0][2] * b.cols[1][0] + a.cols[1][2] * b.cols[1][1];
	return m;
}
HCC_INTRINSIC mat2x4f mulm2x4m4x2f(mat2x4f a, mat4x2f b) {
	mat2x4f m;
	m.cols[0][0] = a.cols[0][0] * b.cols[0][0] + a.cols[1][0] * b.cols[0][1];
	m.cols[0][1] = a.cols[0][1] * b.cols[0][0] + a.cols[1][1] * b.cols[0][1];
	m.cols[0][2] = a.cols[0][2] * b.cols[0][0] + a.cols[1][2] * b.cols[0][1];
	m.cols[0][3] = a.cols[0][3] * b.cols[0][0] + a.cols[1][3] * b.cols[0][1];
	m.cols[1][0] = a.cols[0][0] * b.cols[1][0] + a.cols[1][0] * b.cols[1][1];
	m.cols[1][1] = a.cols[0][1] * b.cols[1][0] + a.cols[1][1] * b.cols[1][1];
	m.cols[1][2] = a.cols[0][2] * b.cols[1][0] + a.cols[1][2] * b.cols[1][1];
	m.cols[1][3] = a.cols[0][3] * b.cols[1][0] + a.cols[1][3] * b.cols[1][1];
	return m;
}
HCC_INTRINSIC mat2x4d mulm2x4m4x2d(mat2x4d a, mat4x2d b) {
	mat2x4d m;
	m.cols[0][0] = a.cols[0][0] * b.cols[0][0] + a.cols[1][0] * b.cols[0][1];
	m.cols[0][1] = a.cols[0][1] * b.cols[0][0] + a.cols[1][1] * b.cols[0][1];
	m.cols[0][2] = a.cols[0][2] * b.cols[0][0] + a.cols[1][2] * b.cols[0][1];
	m.cols[0][3] = a.cols[0][3] * b.cols[0][0] + a.cols[1][3] * b.cols[0][1];
	m.cols[1][0] = a.cols[0][0] * b.cols[1][0] + a.cols[1][0] * b.cols[1][1];
	m.cols[1][1] = a.cols[0][1] * b.cols[1][0] + a.cols[1][1] * b.cols[1][1];
	m.cols[1][2] = a.cols[0][2] * b.cols[1][0] + a.cols[1][2] * b.cols[1][1];
	m.cols[1][3] = a.cols[0][3] * b.cols[1][0] + a.cols[1][3] * b.cols[1][1];
	return m;
}
HCC_INTRINSIC mat3x2f mulm3x2m2x3f(mat3x2f a, mat2x3f b) {
	mat3x2f m;
	m.cols[0][0] = a.cols[0][0] * b.cols[0][0] + a.cols[1][0] * b.cols[0][1] + a.cols[2][0] * b.cols[0][2];
	m.cols[0][1] = a.cols[0][1] * b.cols[0][0] + a.cols[1][1] * b.cols[0][1] + a.cols[2][1] * b.cols[0][2];
	m.cols[1][0] = a.cols[0][0] * b.cols[1][0] + a.cols[1][0] * b.cols[1][1] + a.cols[2][0] * b.cols[1][2];
	m.cols[1][1] = a.cols[0][1] * b.cols[1][0] + a.cols[1][1] * b.cols[1][1] + a.cols[2][1] * b.cols[1][2];
	m.cols[2][0] = a.cols[0][0] * b.cols[2][0] + a.cols[1][0] * b.cols[2][1] + a.cols[2][0] * b.cols[2][2];
	m.cols[2][1] = a.cols[0][1] * b.cols[2][0] + a.cols[1][1] * b.cols[2][1] + a.cols[2][1] * b.cols[2][2];
	return m;
}
HCC_INTRINSIC mat3x2d mulm3x2m2x3d(mat3x2d a, mat2x3d b) {
	mat3x2d m;
	m.cols[0][0] = a.cols[0][0] * b.cols[0][0] + a.cols[1][0] * b.cols[0][1] + a.cols[2][0] * b.cols[0][2];
	m.cols[0][1] = a.cols[0][1] * b.cols[0][0] + a.cols[1][1] * b.cols[0][1] + a.cols[2][1] * b.cols[0][2];
	m.cols[1][0] = a.cols[0][0] * b.cols[1][0] + a.cols[1][0] * b.cols[1][1] + a.cols[2][0] * b.cols[1][2];
	m.cols[1][1] = a.cols[0][1] * b.cols[1][0] + a.cols[1][1] * b.cols[1][1] + a.cols[2][1] * b.cols[1][2];
	m.cols[2][0] = a.cols[0][0] * b.cols[2][0] + a.cols[1][0] * b.cols[2][1] + a.cols[2][0] * b.cols[2][2];
	m.cols[2][1] = a.cols[0][1] * b.cols[2][0] + a.cols[1][1] * b.cols[2][1] + a.cols[2][1] * b.cols[2][2];
	return m;
}
HCC_INTRINSIC mat3x3f mulm3x3m3x3f(mat3x3f a, mat3x3f b) {
	mat3x3f m;
	m.cols[0][0] = a.cols[0][0] * b.cols[0][0] + a.cols[1][0] * b.cols[0][1] + a.cols[2][0] * b.cols[0][2];
	m.cols[0][1] = a.cols[0][1] * b.cols[0][0] + a.cols[1][1] * b.cols[0][1] + a.cols[2][1] * b.cols[0][2];
	m.cols[0][2] = a.cols[0][2] * b.cols[0][0] + a.cols[1][2] * b.cols[0][1] + a.cols[2][2] * b.cols[0][2];
	m.cols[1][0] = a.cols[0][0] * b.cols[1][0] + a.cols[1][0] * b.cols[1][1] + a.cols[2][0] * b.cols[1][2];
	m.cols[1][1] = a.cols[0][1] * b.cols[1][0] + a.cols[1][1] * b.cols[1][1] + a.cols[2][1] * b.cols[1][2];
	m.cols[1][2] = a.cols[0][2] * b.cols[1][0] + a.cols[1][2] * b.cols[1][1] + a.cols[2][2] * b.cols[1][2];
	m.cols[2][0] = a.cols[0][0] * b.cols[2][0] + a.cols[1][0] * b.cols[2][1] + a.cols[2][0] * b.cols[2][2];
	m.cols[2][1] = a.cols[0][1] * b.cols[2][0] + a.cols[1][1] * b.cols[2][1] + a.cols[2][1] * b.cols[2][2];
	m.cols[2][2] = a.cols[0][2] * b.cols[2][0] + a.cols[1][2] * b.cols[2][1] + a.cols[2][2] * b.cols[2][2];
	return m;
}
HCC_INTRINSIC mat3x3d mulm3x3m3x3d(mat3x3d a, mat3x3d b) {
	mat3x3d m;
	m.cols[0][0] = a.cols[0][0] * b.cols[0][0] + a.cols[1][0] * b.cols[0][1] + a.cols[2][0] * b.cols[0][2];
	m.cols[0][1] = a.cols[0][1] * b.cols[0][0] + a.cols[1][1] * b.cols[0][1] + a.cols[2][1] * b.cols[0][2];
	m.cols[0][2] = a.cols[0][2] * b.cols[0][0] + a.cols[1][2] * b.cols[0][1] + a.cols[2][2] * b.cols[0][2];
	m.cols[1][0] = a.cols[0][0] * b.cols[1][0] + a.cols[1][0] * b.cols[1][1] + a.cols[2][0] * b.cols[1][2];
	m.cols[1][1] = a.cols[0][1] * b.cols[1][0] + a.cols[1][1] * b.cols[1][1] + a.cols[2][1] * b.cols[1][2];
	m.cols[1][2] = a.cols[0][2] * b.cols[1][0] + a.cols[1][2] * b.cols[1][1] + a.cols[2][2] * b.cols[1][2];
	m.cols[2][0] = a.cols[0][0] * b.cols[2][0] + a.cols[1][0] * b.cols[2][1] + a.cols[2][0] * b.cols[2][2];
	m.cols[2][1] = a.cols[0][1] * b.cols[2][0] + a.cols[1][1] * b.cols[2][1] + a.cols[2][1] * b.cols[2][2];
	m.cols[2][2] = a.cols[0][2] * b.cols[2][0] + a.cols[1][2] * b.cols[2][1] + a.cols[2][2] * b.cols[2][2];
	return m;
}
HCC_INTRINSIC mat3x4f mulm3x4m4x3f(mat3x4f a, mat4x3f b) {
	mat3x4f m;
	m.cols[0][0] = a.cols[0][0] * b.cols[0][0] + a.cols[1][0] * b.cols[0][1] + a.cols[2][0] * b.cols[0][2];
	m.cols[0][1] = a.cols[0][1] * b.cols[0][0] + a.cols[1][1] * b.cols[0][1] + a.cols[2][1] * b.cols[0][2];
	m.cols[0][2] = a.cols[0][2] * b.cols[0][0] + a.cols[1][2] * b.cols[0][1] + a.cols[2][2] * b.cols[0][2];
	m.cols[0][3] = a.cols[0][3] * b.cols[0][0] + a.cols[1][3] * b.cols[0][1] + a.cols[2][3] * b.cols[0][2];
	m.cols[1][0] = a.cols[0][0] * b.cols[1][0] + a.cols[1][0] * b.cols[1][1] + a.cols[2][0] * b.cols[1][2];
	m.cols[1][1] = a.cols[0][1] * b.cols[1][0] + a.cols[1][1] * b.cols[1][1] + a.cols[2][1] * b.cols[1][2];
	m.cols[1][2] = a.cols[0][2] * b.cols[1][0] + a.cols[1][2] * b.cols[1][1] + a.cols[2][2] * b.cols[1][2];
	m.cols[1][3] = a.cols[0][3] * b.cols[1][0] + a.cols[1][3] * b.cols[1][1] + a.cols[2][3] * b.cols[1][2];
	m.cols[2][0] = a.cols[0][0] * b.cols[2][0] + a.cols[1][0] * b.cols[2][1] + a.cols[2][0] * b.cols[2][2];
	m.cols[2][1] = a.cols[0][1] * b.cols[2][0] + a.cols[1][1] * b.cols[2][1] + a.cols[2][1] * b.cols[2][2];
	m.cols[2][2] = a.cols[0][2] * b.cols[2][0] + a.cols[1][2] * b.cols[2][1] + a.cols[2][2] * b.cols[2][2];
	m.cols[2][3] = a.cols[0][3] * b.cols[2][0] + a.cols[1][3] * b.cols[2][1] + a.cols[2][3] * b.cols[2][2];
	return m;
}
HCC_INTRINSIC mat3x4d mulm3x4m4x3d(mat3x4d a, mat4x3d b) {
	mat3x4d m;
	m.cols[0][0] = a.cols[0][0] * b.cols[0][0] + a.cols[1][0] * b.cols[0][1] + a.cols[2][0] * b.cols[0][2];
	m.cols[0][1] = a.cols[0][1] * b.cols[0][0] + a.cols[1][1] * b.cols[0][1] + a.cols[2][1] * b.cols[0][2];
	m.cols[0][2] = a.cols[0][2] * b.cols[0][0] + a.cols[1][2] * b.cols[0][1] + a.cols[2][2] * b.cols[0][2];
	m.cols[0][3] = a.cols[0][3] * b.cols[0][0] + a.cols[1][3] * b.cols[0][1] + a.cols[2][3] * b.cols[0][2];
	m.cols[1][0] = a.cols[0][0] * b.cols[1][0] + a.cols[1][0] * b.cols[1][1] + a.cols[2][0] * b.cols[1][2];
	m.cols[1][1] = a.cols[0][1] * b.cols[1][0] + a.cols[1][1] * b.cols[1][1] + a.cols[2][1] * b.cols[1][2];
	m.cols[1][2] = a.cols[0][2] * b.cols[1][0] + a.cols[1][2] * b.cols[1][1] + a.cols[2][2] * b.cols[1][2];
	m.cols[1][3] = a.cols[0][3] * b.cols[1][0] + a.cols[1][3] * b.cols[1][1] + a.cols[2][3] * b.cols[1][2];
	m.cols[2][0] = a.cols[0][0] * b.cols[2][0] + a.cols[1][0] * b.cols[2][1] + a.cols[2][0] * b.cols[2][2];
	m.cols[2][1] = a.cols[0][1] * b.cols[2][0] + a.cols[1][1] * b.cols[2][1] + a.cols[2][1] * b.cols[2][2];
	m.cols[2][2] = a.cols[0][2] * b.cols[2][0] + a.cols[1][2] * b.cols[2][1] + a.cols[2][2] * b.cols[2][2];
	m.cols[2][3] = a.cols[0][3] * b.cols[2][0] + a.cols[1][3] * b.cols[2][1] + a.cols[2][3] * b.cols[2][2];
	return m;
}
HCC_INTRINSIC mat4x2f mulm4x2m2x4f(mat4x2f a, mat2x4f b) {
	mat4x2f m;
	m.cols[0][0] = a.cols[0][0] * b.cols[0][0] + a.cols[1][0] * b.cols[0][1] + a.cols[2][0] * b.cols[0][2] + a.cols[3][0] * b.cols[0][3];
	m.cols[0][1] = a.cols[0][1] * b.cols[0][0] + a.cols[1][1] * b.cols[0][1] + a.cols[2][1] * b.cols[0][2] + a.cols[3][1] * b.cols[0][3];
	m.cols[1][0] = a.cols[0][0] * b.cols[1][0] + a.cols[1][0] * b.cols[1][1] + a.cols[2][0] * b.cols[1][2] + a.cols[3][0] * b.cols[1][3];
	m.cols[1][1] = a.cols[0][1] * b.cols[1][0] + a.cols[1][1] * b.cols[1][1] + a.cols[2][1] * b.cols[1][2] + a.cols[3][1] * b.cols[1][3];
	m.cols[2][0] = a.cols[0][0] * b.cols[2][0] + a.cols[1][0] * b.cols[2][1] + a.cols[2][0] * b.cols[2][2] + a.cols[3][0] * b.cols[2][3];
	m.cols[2][1] = a.cols[0][1] * b.cols[2][0] + a.cols[1][1] * b.cols[2][1] + a.cols[2][1] * b.cols[2][2] + a.cols[3][1] * b.cols[2][3];
	m.cols[3][0] = a.cols[0][0] * b.cols[3][0] + a.cols[1][0] * b.cols[3][1] + a.cols[2][0] * b.cols[3][2] + a.cols[3][0] * b.cols[3][3];
	m.cols[3][1] = a.cols[0][1] * b.cols[3][0] + a.cols[1][1] * b.cols[3][1] + a.cols[2][1] * b.cols[3][2] + a.cols[3][1] * b.cols[3][3];
	return m;
}
HCC_INTRINSIC mat4x2d mulm4x2m2x4d(mat4x2d a, mat2x4d b) {
	mat4x2d m;
	m.cols[0][0] = a.cols[0][0] * b.cols[0][0] + a.cols[1][0] * b.cols[0][1] + a.cols[2][0] * b.cols[0][2] + a.cols[3][0] * b.cols[0][3];
	m.cols[0][1] = a.cols[0][1] * b.cols[0][0] + a.cols[1][1] * b.cols[0][1] + a.cols[2][1] * b.cols[0][2] + a.cols[3][1] * b.cols[0][3];
	m.cols[1][0] = a.cols[0][0] * b.cols[1][0] + a.cols[1][0] * b.cols[1][1] + a.cols[2][0] * b.cols[1][2] + a.cols[3][0] * b.cols[1][3];
	m.cols[1][1] = a.cols[0][1] * b.cols[1][0] + a.cols[1][1] * b.cols[1][1] + a.cols[2][1] * b.cols[1][2] + a.cols[3][1] * b.cols[1][3];
	m.cols[2][0] = a.cols[0][0] * b.cols[2][0] + a.cols[1][0] * b.cols[2][1] + a.cols[2][0] * b.cols[2][2] + a.cols[3][0] * b.cols[2][3];
	m.cols[2][1] = a.cols[0][1] * b.cols[2][0] + a.cols[1][1] * b.cols[2][1] + a.cols[2][1] * b.cols[2][2] + a.cols[3][1] * b.cols[2][3];
	m.cols[3][0] = a.cols[0][0] * b.cols[3][0] + a.cols[1][0] * b.cols[3][1] + a.cols[2][0] * b.cols[3][2] + a.cols[3][0] * b.cols[3][3];
	m.cols[3][1] = a.cols[0][1] * b.cols[3][0] + a.cols[1][1] * b.cols[3][1] + a.cols[2][1] * b.cols[3][2] + a.cols[3][1] * b.cols[3][3];
	return m;
}
HCC_INTRINSIC mat4x3f mulm4x3m3x4f(mat4x3f a, mat3x4f b) {
	mat4x3f m;
	m.cols[0][0] = a.cols[0][0] * b.cols[0][0] + a.cols[1][0] * b.cols[0][1] + a.cols[2][0] * b.cols[0][2] + a.cols[3][0] * b.cols[0][3];
	m.cols[0][1] = a.cols[0][1] * b.cols[0][0] + a.cols[1][1] * b.cols[0][1] + a.cols[2][1] * b.cols[0][2] + a.cols[3][1] * b.cols[0][3];
	m.cols[0][2] = a.cols[0][2] * b.cols[0][0] + a.cols[1][2] * b.cols[0][1] + a.cols[2][2] * b.cols[0][2] + a.cols[3][2] * b.cols[0][3];
	m.cols[1][0] = a.cols[0][0] * b.cols[1][0] + a.cols[1][0] * b.cols[1][1] + a.cols[2][0] * b.cols[1][2] + a.cols[3][0] * b.cols[1][3];
	m.cols[1][1] = a.cols[0][1] * b.cols[1][0] + a.cols[1][1] * b.cols[1][1] + a.cols[2][1] * b.cols[1][2] + a.cols[3][1] * b.cols[1][3];
	m.cols[1][2] = a.cols[0][2] * b.cols[1][0] + a.cols[1][2] * b.cols[1][1] + a.cols[2][2] * b.cols[1][2] + a.cols[3][2] * b.cols[1][3];
	m.cols[2][0] = a.cols[0][0] * b.cols[2][0] + a.cols[1][0] * b.cols[2][1] + a.cols[2][0] * b.cols[2][2] + a.cols[3][0] * b.cols[2][3];
	m.cols[2][1] = a.cols[0][1] * b.cols[2][0] + a.cols[1][1] * b.cols[2][1] + a.cols[2][1] * b.cols[2][2] + a.cols[3][1] * b.cols[2][3];
	m.cols[2][2] = a.cols[0][2] * b.cols[2][0] + a.cols[1][2] * b.cols[2][1] + a.cols[2][2] * b.cols[2][2] + a.cols[3][2] * b.cols[2][3];
	m.cols[3][0] = a.cols[0][0] * b.cols[3][0] + a.cols[1][0] * b.cols[3][1] + a.cols[2][0] * b.cols[3][2] + a.cols[3][0] * b.cols[3][3];
	m.cols[3][1] = a.cols[0][1] * b.cols[3][0] + a.cols[1][1] * b.cols[3][1] + a.cols[2][1] * b.cols[3][2] + a.cols[3][1] * b.cols[3][3];
	m.cols[3][2] = a.cols[0][2] * b.cols[3][0] + a.cols[1][2] * b.cols[3][1] + a.cols[2][2] * b.cols[3][2] + a.cols[3][2] * b.cols[3][3];
	return m;
}
HCC_INTRINSIC mat4x3d mulm4x3m3x4d(mat4x3d a, mat3x4d b) {
	mat4x3d m;
	m.cols[0][0] = a.cols[0][0] * b.cols[0][0] + a.cols[1][0] * b.cols[0][1] + a.cols[2][0] * b.cols[0][2] + a.cols[3][0] * b.cols[0][3];
	m.cols[0][1] = a.cols[0][1] * b.cols[0][0] + a.cols[1][1] * b.cols[0][1] + a.cols[2][1] * b.cols[0][2] + a.cols[3][1] * b.cols[0][3];
	m.cols[0][2] = a.cols[0][2] * b.cols[0][0] + a.cols[1][2] * b.cols[0][1] + a.cols[2][2] * b.cols[0][2] + a.cols[3][2] * b.cols[0][3];
	m.cols[1][0] = a.cols[0][0] * b.cols[1][0] + a.cols[1][0] * b.cols[1][1] + a.cols[2][0] * b.cols[1][2] + a.cols[3][0] * b.cols[1][3];
	m.cols[1][1] = a.cols[0][1] * b.cols[1][0] + a.cols[1][1] * b.cols[1][1] + a.cols[2][1] * b.cols[1][2] + a.cols[3][1] * b.cols[1][3];
	m.cols[1][2] = a.cols[0][2] * b.cols[1][0] + a.cols[1][2] * b.cols[1][1] + a.cols[2][2] * b.cols[1][2] + a.cols[3][2] * b.cols[1][3];
	m.cols[2][0] = a.cols[0][0] * b.cols[2][0] + a.cols[1][0] * b.cols[2][1] + a.cols[2][0] * b.cols[2][2] + a.cols[3][0] * b.cols[2][3];
	m.cols[2][1] = a.cols[0][1] * b.cols[2][0] + a.cols[1][1] * b.cols[2][1] + a.cols[2][1] * b.cols[2][2] + a.cols[3][1] * b.cols[2][3];
	m.cols[2][2] = a.cols[0][2] * b.cols[2][0] + a.cols[1][2] * b.cols[2][1] + a.cols[2][2] * b.cols[2][2] + a.cols[3][2] * b.cols[2][3];
	m.cols[3][0] = a.cols[0][0] * b.cols[3][0] + a.cols[1][0] * b.cols[3][1] + a.cols[2][0] * b.cols[3][2] + a.cols[3][0] * b.cols[3][3];
	m.cols[3][1] = a.cols[0][1] * b.cols[3][0] + a.cols[1][1] * b.cols[3][1] + a.cols[2][1] * b.cols[3][2] + a.cols[3][1] * b.cols[3][3];
	m.cols[3][2] = a.cols[0][2] * b.cols[3][0] + a.cols[1][2] * b.cols[3][1] + a.cols[2][2] * b.cols[3][2] + a.cols[3][2] * b.cols[3][3];
	return m;
}
HCC_INTRINSIC mat4x4f mulm4x4m4x4f(mat4x4f a, mat4x4f b) {
	mat4x4f m;
	m.cols[0][0] = a.cols[0][0] * b.cols[0][0] + a.cols[1][0] * b.cols[0][1] + a.cols[2][0] * b.cols[0][2] + a.cols[3][0] * b.cols[0][3];
	m.cols[0][1] = a.cols[0][1] * b.cols[0][0] + a.cols[1][1] * b.cols[0][1] + a.cols[2][1] * b.cols[0][2] + a.cols[3][1] * b.cols[0][3];
	m.cols[0][2] = a.cols[0][2] * b.cols[0][0] + a.cols[1][2] * b.cols[0][1] + a.cols[2][2] * b.cols[0][2] + a.cols[3][2] * b.cols[0][3];
	m.cols[0][3] = a.cols[0][3] * b.cols[0][0] + a.cols[1][3] * b.cols[0][1] + a.cols[2][3] * b.cols[0][2] + a.cols[3][3] * b.cols[0][3];
	m.cols[1][0] = a.cols[0][0] * b.cols[1][0] + a.cols[1][0] * b.cols[1][1] + a.cols[2][0] * b.cols[1][2] + a.cols[3][0] * b.cols[1][3];
	m.cols[1][1] = a.cols[0][1] * b.cols[1][0] + a.cols[1][1] * b.cols[1][1] + a.cols[2][1] * b.cols[1][2] + a.cols[3][1] * b.cols[1][3];
	m.cols[1][2] = a.cols[0][2] * b.cols[1][0] + a.cols[1][2] * b.cols[1][1] + a.cols[2][2] * b.cols[1][2] + a.cols[3][2] * b.cols[1][3];
	m.cols[1][3] = a.cols[0][3] * b.cols[1][0] + a.cols[1][3] * b.cols[1][1] + a.cols[2][3] * b.cols[1][2] + a.cols[3][3] * b.cols[1][3];
	m.cols[2][0] = a.cols[0][0] * b.cols[2][0] + a.cols[1][0] * b.cols[2][1] + a.cols[2][0] * b.cols[2][2] + a.cols[3][0] * b.cols[2][3];
	m.cols[2][1] = a.cols[0][1] * b.cols[2][0] + a.cols[1][1] * b.cols[2][1] + a.cols[2][1] * b.cols[2][2] + a.cols[3][1] * b.cols[2][3];
	m.cols[2][2] = a.cols[0][2] * b.cols[2][0] + a.cols[1][2] * b.cols[2][1] + a.cols[2][2] * b.cols[2][2] + a.cols[3][2] * b.cols[2][3];
	m.cols[2][3] = a.cols[0][3] * b.cols[2][0] + a.cols[1][3] * b.cols[2][1] + a.cols[2][3] * b.cols[2][2] + a.cols[3][3] * b.cols[2][3];
	m.cols[3][0] = a.cols[0][0] * b.cols[3][0] + a.cols[1][0] * b.cols[3][1] + a.cols[2][0] * b.cols[3][2] + a.cols[3][0] * b.cols[3][3];
	m.cols[3][1] = a.cols[0][1] * b.cols[3][0] + a.cols[1][1] * b.cols[3][1] + a.cols[2][1] * b.cols[3][2] + a.cols[3][1] * b.cols[3][3];
	m.cols[3][2] = a.cols[0][2] * b.cols[3][0] + a.cols[1][2] * b.cols[3][1] + a.cols[2][2] * b.cols[3][2] + a.cols[3][2] * b.cols[3][3];
	m.cols[3][3] = a.cols[0][3] * b.cols[3][0] + a.cols[1][3] * b.cols[3][1] + a.cols[2][3] * b.cols[3][2] + a.cols[3][3] * b.cols[3][3];
	return m;
}
HCC_INTRINSIC mat4x4d mulm4x4m4x4d(mat4x4d a, mat4x4d b) {
	mat4x4d m;
	m.cols[0][0] = a.cols[0][0] * b.cols[0][0] + a.cols[1][0] * b.cols[0][1] + a.cols[2][0] * b.cols[0][2] + a.cols[3][0] * b.cols[0][3];
	m.cols[0][1] = a.cols[0][1] * b.cols[0][0] + a.cols[1][1] * b.cols[0][1] + a.cols[2][1] * b.cols[0][2] + a.cols[3][1] * b.cols[0][3];
	m.cols[0][2] = a.cols[0][2] * b.cols[0][0] + a.cols[1][2] * b.cols[0][1] + a.cols[2][2] * b.cols[0][2] + a.cols[3][2] * b.cols[0][3];
	m.cols[0][3] = a.cols[0][3] * b.cols[0][0] + a.cols[1][3] * b.cols[0][1] + a.cols[2][3] * b.cols[0][2] + a.cols[3][3] * b.cols[0][3];
	m.cols[1][0] = a.cols[0][0] * b.cols[1][0] + a.cols[1][0] * b.cols[1][1] + a.cols[2][0] * b.cols[1][2] + a.cols[3][0] * b.cols[1][3];
	m.cols[1][1] = a.cols[0][1] * b.cols[1][0] + a.cols[1][1] * b.cols[1][1] + a.cols[2][1] * b.cols[1][2] + a.cols[3][1] * b.cols[1][3];
	m.cols[1][2] = a.cols[0][2] * b.cols[1][0] + a.cols[1][2] * b.cols[1][1] + a.cols[2][2] * b.cols[1][2] + a.cols[3][2] * b.cols[1][3];
	m.cols[1][3] = a.cols[0][3] * b.cols[1][0] + a.cols[1][3] * b.cols[1][1] + a.cols[2][3] * b.cols[1][2] + a.cols[3][3] * b.cols[1][3];
	m.cols[2][0] = a.cols[0][0] * b.cols[2][0] + a.cols[1][0] * b.cols[2][1] + a.cols[2][0] * b.cols[2][2] + a.cols[3][0] * b.cols[2][3];
	m.cols[2][1] = a.cols[0][1] * b.cols[2][0] + a.cols[1][1] * b.cols[2][1] + a.cols[2][1] * b.cols[2][2] + a.cols[3][1] * b.cols[2][3];
	m.cols[2][2] = a.cols[0][2] * b.cols[2][0] + a.cols[1][2] * b.cols[2][1] + a.cols[2][2] * b.cols[2][2] + a.cols[3][2] * b.cols[2][3];
	m.cols[2][3] = a.cols[0][3] * b.cols[2][0] + a.cols[1][3] * b.cols[2][1] + a.cols[2][3] * b.cols[2][2] + a.cols[3][3] * b.cols[2][3];
	m.cols[3][0] = a.cols[0][0] * b.cols[3][0] + a.cols[1][0] * b.cols[3][1] + a.cols[2][0] * b.cols[3][2] + a.cols[3][0] * b.cols[3][3];
	m.cols[3][1] = a.cols[0][1] * b.cols[3][0] + a.cols[1][1] * b.cols[3][1] + a.cols[2][1] * b.cols[3][2] + a.cols[3][1] * b.cols[3][3];
	m.cols[3][2] = a.cols[0][2] * b.cols[3][0] + a.cols[1][2] * b.cols[3][1] + a.cols[2][2] * b.cols[3][2] + a.cols[3][2] * b.cols[3][3];
	m.cols[3][3] = a.cols[0][3] * b.cols[3][0] + a.cols[1][3] * b.cols[3][1] + a.cols[2][3] * b.cols[3][2] + a.cols[3][3] * b.cols[3][3];
	return m;
}

//
// returns a matrix that is a result of multipling matrix 'm' with scalar 's'
HCC_INTRINSIC mat2x2f mulsm2x2f(mat2x2f m, float s) {
	m.cols[0][0] *= s;
	m.cols[0][1] *= s;
	m.cols[1][0] *= s;
	m.cols[1][1] *= s;
	return m;
}
HCC_INTRINSIC mat2x2d mulsm2x2d(mat2x2d m, double s) {
	m.cols[0][0] *= s;
	m.cols[0][1] *= s;
	m.cols[1][0] *= s;
	m.cols[1][1] *= s;
	return m;
}
HCC_INTRINSIC mat2x3f mulsm2x3f(mat2x3f m, float s) {
	m.cols[0][0] *= s;
	m.cols[0][1] *= s;
	m.cols[0][2] *= s;
	m.cols[1][0] *= s;
	m.cols[1][1] *= s;
	m.cols[1][2] *= s;
	return m;
}
HCC_INTRINSIC mat2x3d mulsm2x3d(mat2x3d m, double s) {
	m.cols[0][0] *= s;
	m.cols[0][1] *= s;
	m.cols[0][2] *= s;
	m.cols[1][0] *= s;
	m.cols[1][1] *= s;
	m.cols[1][2] *= s;
	return m;
}
HCC_INTRINSIC mat2x4f mulsm2x4f(mat2x4f m, float s) {
	m.cols[0][0] *= s;
	m.cols[0][1] *= s;
	m.cols[0][2] *= s;
	m.cols[0][3] *= s;
	m.cols[1][0] *= s;
	m.cols[1][1] *= s;
	m.cols[1][2] *= s;
	m.cols[1][3] *= s;
	return m;
}
HCC_INTRINSIC mat2x4d mulsm2x4d(mat2x4d m, double s) {
	m.cols[0][0] *= s;
	m.cols[0][1] *= s;
	m.cols[0][2] *= s;
	m.cols[0][3] *= s;
	m.cols[1][0] *= s;
	m.cols[1][1] *= s;
	m.cols[1][2] *= s;
	m.cols[1][3] *= s;
	return m;
}
HCC_INTRINSIC mat3x2f mulsm3x2f(mat3x2f m, float s) {
	m.cols[0][0] *= s;
	m.cols[0][1] *= s;
	m.cols[1][0] *= s;
	m.cols[1][1] *= s;
	m.cols[2][0] *= s;
	m.cols[2][1] *= s;
	return m;
}
HCC_INTRINSIC mat3x2d mulsm3x2d(mat3x2d m, double s) {
	m.cols[0][0] *= s;
	m.cols[0][1] *= s;
	m.cols[1][0] *= s;
	m.cols[1][1] *= s;
	m.cols[2][0] *= s;
	m.cols[2][1] *= s;
	return m;
}
HCC_INTRINSIC mat3x3f mulsm3x3f(mat3x3f m, float s) {
	m.cols[0][0] *= s;
	m.cols[0][1] *= s;
	m.cols[0][2] *= s;
	m.cols[1][0] *= s;
	m.cols[1][1] *= s;
	m.cols[1][2] *= s;
	m.cols[2][0] *= s;
	m.cols[2][1] *= s;
	m.cols[2][2] *= s;
	return m;
}
HCC_INTRINSIC mat3x3d mulsm3x3d(mat3x3d m, double s) {
	m.cols[0][0] *= s;
	m.cols[0][1] *= s;
	m.cols[0][2] *= s;
	m.cols[1][0] *= s;
	m.cols[1][1] *= s;
	m.cols[1][2] *= s;
	m.cols[2][0] *= s;
	m.cols[2][1] *= s;
	m.cols[2][2] *= s;
	return m;
}
HCC_INTRINSIC mat3x4f mulsm3x4f(mat3x4f m, float s) {
	m.cols[0][0] *= s;
	m.cols[0][1] *= s;
	m.cols[0][2] *= s;
	m.cols[0][3] *= s;
	m.cols[1][0] *= s;
	m.cols[1][1] *= s;
	m.cols[1][2] *= s;
	m.cols[1][3] *= s;
	m.cols[2][0] *= s;
	m.cols[2][1] *= s;
	m.cols[2][2] *= s;
	m.cols[2][3] *= s;
	return m;
}
HCC_INTRINSIC mat3x4d mulsm3x4d(mat3x4d m, double s) {
	m.cols[0][0] *= s;
	m.cols[0][1] *= s;
	m.cols[0][2] *= s;
	m.cols[0][3] *= s;
	m.cols[1][0] *= s;
	m.cols[1][1] *= s;
	m.cols[1][2] *= s;
	m.cols[1][3] *= s;
	m.cols[2][0] *= s;
	m.cols[2][1] *= s;
	m.cols[2][2] *= s;
	m.cols[2][3] *= s;
	return m;
}
HCC_INTRINSIC mat4x2f mulsm4x2f(mat4x2f m, float s) {
	m.cols[0][0] *= s;
	m.cols[0][1] *= s;
	m.cols[1][0] *= s;
	m.cols[1][1] *= s;
	m.cols[2][0] *= s;
	m.cols[2][1] *= s;
	m.cols[3][0] *= s;
	m.cols[3][1] *= s;
	return m;
}
HCC_INTRINSIC mat4x2d mulsm4x2d(mat4x2d m, double s) {
	m.cols[0][0] *= s;
	m.cols[0][1] *= s;
	m.cols[1][0] *= s;
	m.cols[1][1] *= s;
	m.cols[2][0] *= s;
	m.cols[2][1] *= s;
	m.cols[3][0] *= s;
	m.cols[3][1] *= s;
	return m;
}
HCC_INTRINSIC mat4x3f mulsm4x3f(mat4x3f m, float s) {
	m.cols[0][0] *= s;
	m.cols[0][1] *= s;
	m.cols[0][2] *= s;
	m.cols[1][0] *= s;
	m.cols[1][1] *= s;
	m.cols[1][2] *= s;
	m.cols[2][0] *= s;
	m.cols[2][1] *= s;
	m.cols[2][2] *= s;
	m.cols[3][0] *= s;
	m.cols[3][1] *= s;
	m.cols[3][2] *= s;
	return m;
}
HCC_INTRINSIC mat4x3d mulsm4x3d(mat4x3d m, double s) {
	m.cols[0][0] *= s;
	m.cols[0][1] *= s;
	m.cols[0][2] *= s;
	m.cols[1][0] *= s;
	m.cols[1][1] *= s;
	m.cols[1][2] *= s;
	m.cols[2][0] *= s;
	m.cols[2][1] *= s;
	m.cols[2][2] *= s;
	m.cols[3][0] *= s;
	m.cols[3][1] *= s;
	m.cols[3][2] *= s;
	return m;
}
HCC_INTRINSIC mat4x4f mulsm4x4f(mat4x4f m, float s) {
	m.cols[0][0] *= s;
	m.cols[0][1] *= s;
	m.cols[0][2] *= s;
	m.cols[0][3] *= s;
	m.cols[1][0] *= s;
	m.cols[1][1] *= s;
	m.cols[1][2] *= s;
	m.cols[1][3] *= s;
	m.cols[2][0] *= s;
	m.cols[2][1] *= s;
	m.cols[2][2] *= s;
	m.cols[2][3] *= s;
	m.cols[3][0] *= s;
	m.cols[3][1] *= s;
	m.cols[3][2] *= s;
	m.cols[3][3] *= s;
	return m;
}
HCC_INTRINSIC mat4x4d mulsm4x4d(mat4x4d m, double s) {
	m.cols[0][0] *= s;
	m.cols[0][1] *= s;
	m.cols[0][2] *= s;
	m.cols[0][3] *= s;
	m.cols[1][0] *= s;
	m.cols[1][1] *= s;
	m.cols[1][2] *= s;
	m.cols[1][3] *= s;
	m.cols[2][0] *= s;
	m.cols[2][1] *= s;
	m.cols[2][2] *= s;
	m.cols[2][3] *= s;
	m.cols[3][0] *= s;
	m.cols[3][1] *= s;
	m.cols[3][2] *= s;
	m.cols[3][3] *= s;
	return m;
}

//
// returns a vector that is a result of multipling matrix 'm' with vector 'v'
HCC_INTRINSIC vec2f mulm2x2v2f(mat2x2f m, vec2f v) {
	vec2f ret;
	ret.array[0] = m.cols[0][0] * v.array[0] + m.cols[1][0] * v.array[0];
	ret.array[1] = m.cols[0][1] * v.array[1] + m.cols[1][1] * v.array[1];
	return ret;
}
HCC_INTRINSIC vec2d mulm2x2v2d(mat2x2d m, vec2d v) {
	vec2d ret;
	ret.array[0] = m.cols[0][0] * v.array[0] + m.cols[1][0] * v.array[0];
	ret.array[1] = m.cols[0][1] * v.array[1] + m.cols[1][1] * v.array[1];
	return ret;
}
HCC_INTRINSIC vec2f mulm2x3v2f(mat2x3f m, vec2f v) {
	vec2f ret;
	ret.array[0] = m.cols[0][0] * v.array[0] + m.cols[1][0] * v.array[0];
	ret.array[1] = m.cols[0][1] * v.array[1] + m.cols[1][1] * v.array[1];
	return ret;
}
HCC_INTRINSIC vec2d mulm2x3v2d(mat2x3d m, vec2d v) {
	vec2d ret;
	ret.array[0] = m.cols[0][0] * v.array[0] + m.cols[1][0] * v.array[0];
	ret.array[1] = m.cols[0][1] * v.array[1] + m.cols[1][1] * v.array[1];
	return ret;
}
HCC_INTRINSIC vec2f mulm2x4v2f(mat2x4f m, vec2f v) {
	vec2f ret;
	ret.array[0] = m.cols[0][0] * v.array[0] + m.cols[1][0] * v.array[0];
	ret.array[1] = m.cols[0][1] * v.array[1] + m.cols[1][1] * v.array[1];
	return ret;
}
HCC_INTRINSIC vec2d mulm2x4v2d(mat2x4d m, vec2d v) {
	vec2d ret;
	ret.array[0] = m.cols[0][0] * v.array[0] + m.cols[1][0] * v.array[0];
	ret.array[1] = m.cols[0][1] * v.array[1] + m.cols[1][1] * v.array[1];
	return ret;
}
HCC_INTRINSIC vec3f mulm3x2v3f(mat3x2f m, vec3f v) {
	vec3f ret;
	ret.array[0] = m.cols[0][0] * v.array[0] + m.cols[1][0] * v.array[0] + m.cols[2][0] * v.array[0];
	ret.array[1] = m.cols[0][1] * v.array[1] + m.cols[1][1] * v.array[1] + m.cols[2][1] * v.array[1];
	ret.array[2] = m.cols[0][2] * v.array[2] + m.cols[1][2] * v.array[2] + m.cols[2][2] * v.array[2];
	return ret;
}
HCC_INTRINSIC vec3d mulm3x2v3d(mat3x2d m, vec3d v) {
	vec3d ret;
	ret.array[0] = m.cols[0][0] * v.array[0] + m.cols[1][0] * v.array[0] + m.cols[2][0] * v.array[0];
	ret.array[1] = m.cols[0][1] * v.array[1] + m.cols[1][1] * v.array[1] + m.cols[2][1] * v.array[1];
	ret.array[2] = m.cols[0][2] * v.array[2] + m.cols[1][2] * v.array[2] + m.cols[2][2] * v.array[2];
	return ret;
}
HCC_INTRINSIC vec3f mulm3x3v3f(mat3x3f m, vec3f v) {
	vec3f ret;
	ret.array[0] = m.cols[0][0] * v.array[0] + m.cols[1][0] * v.array[0] + m.cols[2][0] * v.array[0];
	ret.array[1] = m.cols[0][1] * v.array[1] + m.cols[1][1] * v.array[1] + m.cols[2][1] * v.array[1];
	ret.array[2] = m.cols[0][2] * v.array[2] + m.cols[1][2] * v.array[2] + m.cols[2][2] * v.array[2];
	return ret;
}
HCC_INTRINSIC vec3d mulm3x3v3d(mat3x3d m, vec3d v) {
	vec3d ret;
	ret.array[0] = m.cols[0][0] * v.array[0] + m.cols[1][0] * v.array[0] + m.cols[2][0] * v.array[0];
	ret.array[1] = m.cols[0][1] * v.array[1] + m.cols[1][1] * v.array[1] + m.cols[2][1] * v.array[1];
	ret.array[2] = m.cols[0][2] * v.array[2] + m.cols[1][2] * v.array[2] + m.cols[2][2] * v.array[2];
	return ret;
}
HCC_INTRINSIC vec3f mulm3x4v3f(mat3x4f m, vec3f v) {
	vec3f ret;
	ret.array[0] = m.cols[0][0] * v.array[0] + m.cols[1][0] * v.array[0] + m.cols[2][0] * v.array[0];
	ret.array[1] = m.cols[0][1] * v.array[1] + m.cols[1][1] * v.array[1] + m.cols[2][1] * v.array[1];
	ret.array[2] = m.cols[0][2] * v.array[2] + m.cols[1][2] * v.array[2] + m.cols[2][2] * v.array[2];
	return ret;
}
HCC_INTRINSIC vec3d mulm3x4v3d(mat3x4d m, vec3d v) {
	vec3d ret;
	ret.array[0] = m.cols[0][0] * v.array[0] + m.cols[1][0] * v.array[0] + m.cols[2][0] * v.array[0];
	ret.array[1] = m.cols[0][1] * v.array[1] + m.cols[1][1] * v.array[1] + m.cols[2][1] * v.array[1];
	ret.array[2] = m.cols[0][2] * v.array[2] + m.cols[1][2] * v.array[2] + m.cols[2][2] * v.array[2];
	return ret;
}
HCC_INTRINSIC vec4f mulm4x2v4f(mat4x2f m, vec4f v) {
	vec4f ret;
	ret.array[0] = m.cols[0][0] * v.array[0] + m.cols[1][0] * v.array[0] + m.cols[2][0] * v.array[0] + m.cols[3][0] * v.array[0];
	ret.array[1] = m.cols[0][1] * v.array[1] + m.cols[1][1] * v.array[1] + m.cols[2][1] * v.array[1] + m.cols[3][1] * v.array[1];
	ret.array[2] = m.cols[0][2] * v.array[2] + m.cols[1][2] * v.array[2] + m.cols[2][2] * v.array[2] + m.cols[3][2] * v.array[2];
	ret.array[3] = m.cols[0][3] * v.array[3] + m.cols[1][3] * v.array[3] + m.cols[2][3] * v.array[3] + m.cols[3][3] * v.array[3];
	return ret;
}
HCC_INTRINSIC vec4d mulm4x2v4d(mat4x2d m, vec4d v) {
	vec4d ret;
	ret.array[0] = m.cols[0][0] * v.array[0] + m.cols[1][0] * v.array[0] + m.cols[2][0] * v.array[0] + m.cols[3][0] * v.array[0];
	ret.array[1] = m.cols[0][1] * v.array[1] + m.cols[1][1] * v.array[1] + m.cols[2][1] * v.array[1] + m.cols[3][1] * v.array[1];
	ret.array[2] = m.cols[0][2] * v.array[2] + m.cols[1][2] * v.array[2] + m.cols[2][2] * v.array[2] + m.cols[3][2] * v.array[2];
	ret.array[3] = m.cols[0][3] * v.array[3] + m.cols[1][3] * v.array[3] + m.cols[2][3] * v.array[3] + m.cols[3][3] * v.array[3];
	return ret;
}
HCC_INTRINSIC vec4f mulm4x3v4f(mat4x3f m, vec4f v) {
	vec4f ret;
	ret.array[0] = m.cols[0][0] * v.array[0] + m.cols[1][0] * v.array[0] + m.cols[2][0] * v.array[0] + m.cols[3][0] * v.array[0];
	ret.array[1] = m.cols[0][1] * v.array[1] + m.cols[1][1] * v.array[1] + m.cols[2][1] * v.array[1] + m.cols[3][1] * v.array[1];
	ret.array[2] = m.cols[0][2] * v.array[2] + m.cols[1][2] * v.array[2] + m.cols[2][2] * v.array[2] + m.cols[3][2] * v.array[2];
	ret.array[3] = m.cols[0][3] * v.array[3] + m.cols[1][3] * v.array[3] + m.cols[2][3] * v.array[3] + m.cols[3][3] * v.array[3];
	return ret;
}
HCC_INTRINSIC vec4d mulm4x3v4d(mat4x3d m, vec4d v) {
	vec4d ret;
	ret.array[0] = m.cols[0][0] * v.array[0] + m.cols[1][0] * v.array[0] + m.cols[2][0] * v.array[0] + m.cols[3][0] * v.array[0];
	ret.array[1] = m.cols[0][1] * v.array[1] + m.cols[1][1] * v.array[1] + m.cols[2][1] * v.array[1] + m.cols[3][1] * v.array[1];
	ret.array[2] = m.cols[0][2] * v.array[2] + m.cols[1][2] * v.array[2] + m.cols[2][2] * v.array[2] + m.cols[3][2] * v.array[2];
	ret.array[3] = m.cols[0][3] * v.array[3] + m.cols[1][3] * v.array[3] + m.cols[2][3] * v.array[3] + m.cols[3][3] * v.array[3];
	return ret;
}
HCC_INTRINSIC vec4f mulm4x4v4f(mat4x4f m, vec4f v) {
	vec4f ret;
	ret.array[0] = m.cols[0][0] * v.array[0] + m.cols[1][0] * v.array[0] + m.cols[2][0] * v.array[0] + m.cols[3][0] * v.array[0];
	ret.array[1] = m.cols[0][1] * v.array[1] + m.cols[1][1] * v.array[1] + m.cols[2][1] * v.array[1] + m.cols[3][1] * v.array[1];
	ret.array[2] = m.cols[0][2] * v.array[2] + m.cols[1][2] * v.array[2] + m.cols[2][2] * v.array[2] + m.cols[3][2] * v.array[2];
	ret.array[3] = m.cols[0][3] * v.array[3] + m.cols[1][3] * v.array[3] + m.cols[2][3] * v.array[3] + m.cols[3][3] * v.array[3];
	return ret;
}
HCC_INTRINSIC vec4d mulm4x4v4d(mat4x4d m, vec4d v) {
	vec4d ret;
	ret.array[0] = m.cols[0][0] * v.array[0] + m.cols[1][0] * v.array[0] + m.cols[2][0] * v.array[0] + m.cols[3][0] * v.array[0];
	ret.array[1] = m.cols[0][1] * v.array[1] + m.cols[1][1] * v.array[1] + m.cols[2][1] * v.array[1] + m.cols[3][1] * v.array[1];
	ret.array[2] = m.cols[0][2] * v.array[2] + m.cols[1][2] * v.array[2] + m.cols[2][2] * v.array[2] + m.cols[3][2] * v.array[2];
	ret.array[3] = m.cols[0][3] * v.array[3] + m.cols[1][3] * v.array[3] + m.cols[2][3] * v.array[3] + m.cols[3][3] * v.array[3];
	return ret;
}

//
// returns a vector that is a result of multipling vector 'v' with matrix 'm'
HCC_INTRINSIC vec2f invmulm2x2v2f(mat2x2f m, vec2f v) {
	vec2f ret;
	ret.array[0] = v.array[0] * m.cols[0][0] + v.array[1] * m.cols[1][0];
	ret.array[1] = v.array[0] * m.cols[0][1] + v.array[1] * m.cols[1][1];
	return ret;
}
HCC_INTRINSIC vec2d invmulm2x2v2d(mat2x2d m, vec2d v) {
	vec2d ret;
	ret.array[0] = v.array[0] * m.cols[0][0] + v.array[1] * m.cols[1][0];
	ret.array[1] = v.array[0] * m.cols[0][1] + v.array[1] * m.cols[1][1];
	return ret;
}
HCC_INTRINSIC vec3f invmulm2x3v3f(mat2x3f m, vec3f v) {
	vec3f ret;
	ret.array[0] = v.array[0] * m.cols[0][0] + v.array[1] * m.cols[1][0];
	ret.array[1] = v.array[0] * m.cols[0][1] + v.array[1] * m.cols[1][1];
	ret.array[2] = v.array[0] * m.cols[0][2] + v.array[1] * m.cols[1][2];
	return ret;
}
HCC_INTRINSIC vec3d invmulm2x3v3d(mat2x3d m, vec3d v) {
	vec3d ret;
	ret.array[0] = v.array[0] * m.cols[0][0] + v.array[1] * m.cols[1][0];
	ret.array[1] = v.array[0] * m.cols[0][1] + v.array[1] * m.cols[1][1];
	ret.array[2] = v.array[0] * m.cols[0][2] + v.array[1] * m.cols[1][2];
	return ret;
}
HCC_INTRINSIC vec4f invmulm2x4v4f(mat2x4f m, vec4f v) {
	vec4f ret;
	ret.array[0] = v.array[0] * m.cols[0][0] + v.array[1] * m.cols[1][0];
	ret.array[1] = v.array[0] * m.cols[0][1] + v.array[1] * m.cols[1][1];
	ret.array[2] = v.array[0] * m.cols[0][2] + v.array[1] * m.cols[1][2];
	ret.array[3] = v.array[0] * m.cols[0][3] + v.array[1] * m.cols[1][3];
	return ret;
}
HCC_INTRINSIC vec4d invmulm2x4v4d(mat2x4d m, vec4d v) {
	vec4d ret;
	ret.array[0] = v.array[0] * m.cols[0][0] + v.array[1] * m.cols[1][0];
	ret.array[1] = v.array[0] * m.cols[0][1] + v.array[1] * m.cols[1][1];
	ret.array[2] = v.array[0] * m.cols[0][2] + v.array[1] * m.cols[1][2];
	ret.array[3] = v.array[0] * m.cols[0][3] + v.array[1] * m.cols[1][3];
	return ret;
}
HCC_INTRINSIC vec2f invmulm3x2v2f(mat3x2f m, vec2f v) {
	vec2f ret;
	ret.array[0] = v.array[0] * m.cols[0][0] + v.array[1] * m.cols[1][0] + v.array[2] * m.cols[2][0];
	ret.array[1] = v.array[0] * m.cols[0][1] + v.array[1] * m.cols[1][1] + v.array[2] * m.cols[2][1];
	return ret;
}
HCC_INTRINSIC vec2d invmulm3x2v2d(mat3x2d m, vec2d v) {
	vec2d ret;
	ret.array[0] = v.array[0] * m.cols[0][0] + v.array[1] * m.cols[1][0] + v.array[2] * m.cols[2][0];
	ret.array[1] = v.array[0] * m.cols[0][1] + v.array[1] * m.cols[1][1] + v.array[2] * m.cols[2][1];
	return ret;
}
HCC_INTRINSIC vec3f invmulm3x3v3f(mat3x3f m, vec3f v) {
	vec3f ret;
	ret.array[0] = v.array[0] * m.cols[0][0] + v.array[1] * m.cols[1][0] + v.array[2] * m.cols[2][0];
	ret.array[1] = v.array[0] * m.cols[0][1] + v.array[1] * m.cols[1][1] + v.array[2] * m.cols[2][1];
	ret.array[2] = v.array[0] * m.cols[0][2] + v.array[1] * m.cols[1][2] + v.array[2] * m.cols[2][2];
	return ret;
}
HCC_INTRINSIC vec3d invmulm3x3v3d(mat3x3d m, vec3d v) {
	vec3d ret;
	ret.array[0] = v.array[0] * m.cols[0][0] + v.array[1] * m.cols[1][0] + v.array[2] * m.cols[2][0];
	ret.array[1] = v.array[0] * m.cols[0][1] + v.array[1] * m.cols[1][1] + v.array[2] * m.cols[2][1];
	ret.array[2] = v.array[0] * m.cols[0][2] + v.array[1] * m.cols[1][2] + v.array[2] * m.cols[2][2];
	return ret;
}
HCC_INTRINSIC vec4f invmulm3x4v4f(mat3x4f m, vec4f v) {
	vec4f ret;
	ret.array[0] = v.array[0] * m.cols[0][0] + v.array[1] * m.cols[1][0] + v.array[2] * m.cols[2][0];
	ret.array[1] = v.array[0] * m.cols[0][1] + v.array[1] * m.cols[1][1] + v.array[2] * m.cols[2][1];
	ret.array[2] = v.array[0] * m.cols[0][2] + v.array[1] * m.cols[1][2] + v.array[2] * m.cols[2][2];
	ret.array[3] = v.array[0] * m.cols[0][3] + v.array[1] * m.cols[1][3] + v.array[2] * m.cols[2][3];
	return ret;
}
HCC_INTRINSIC vec4d invmulm3x4v4d(mat3x4d m, vec4d v) {
	vec4d ret;
	ret.array[0] = v.array[0] * m.cols[0][0] + v.array[1] * m.cols[1][0] + v.array[2] * m.cols[2][0];
	ret.array[1] = v.array[0] * m.cols[0][1] + v.array[1] * m.cols[1][1] + v.array[2] * m.cols[2][1];
	ret.array[2] = v.array[0] * m.cols[0][2] + v.array[1] * m.cols[1][2] + v.array[2] * m.cols[2][2];
	ret.array[3] = v.array[0] * m.cols[0][3] + v.array[1] * m.cols[1][3] + v.array[2] * m.cols[2][3];
	return ret;
}
HCC_INTRINSIC vec2f invmulm4x2v2f(mat4x2f m, vec2f v) {
	vec2f ret;
	ret.array[0] = v.array[0] * m.cols[0][0] + v.array[1] * m.cols[1][0] + v.array[2] * m.cols[2][0] + v.array[3] * m.cols[3][0];
	ret.array[1] = v.array[0] * m.cols[0][1] + v.array[1] * m.cols[1][1] + v.array[2] * m.cols[2][1] + v.array[3] * m.cols[3][1];
	return ret;
}
HCC_INTRINSIC vec2d invmulm4x2v2d(mat4x2d m, vec2d v) {
	vec2d ret;
	ret.array[0] = v.array[0] * m.cols[0][0] + v.array[1] * m.cols[1][0] + v.array[2] * m.cols[2][0] + v.array[3] * m.cols[3][0];
	ret.array[1] = v.array[0] * m.cols[0][1] + v.array[1] * m.cols[1][1] + v.array[2] * m.cols[2][1] + v.array[3] * m.cols[3][1];
	return ret;
}
HCC_INTRINSIC vec3f invmulm4x3v3f(mat4x3f m, vec3f v) {
	vec3f ret;
	ret.array[0] = v.array[0] * m.cols[0][0] + v.array[1] * m.cols[1][0] + v.array[2] * m.cols[2][0] + v.array[3] * m.cols[3][0];
	ret.array[1] = v.array[0] * m.cols[0][1] + v.array[1] * m.cols[1][1] + v.array[2] * m.cols[2][1] + v.array[3] * m.cols[3][1];
	ret.array[2] = v.array[0] * m.cols[0][2] + v.array[1] * m.cols[1][2] + v.array[2] * m.cols[2][2] + v.array[3] * m.cols[3][2];
	return ret;
}
HCC_INTRINSIC vec3d invmulm4x3v3d(mat4x3d m, vec3d v) {
	vec3d ret;
	ret.array[0] = v.array[0] * m.cols[0][0] + v.array[1] * m.cols[1][0] + v.array[2] * m.cols[2][0] + v.array[3] * m.cols[3][0];
	ret.array[1] = v.array[0] * m.cols[0][1] + v.array[1] * m.cols[1][1] + v.array[2] * m.cols[2][1] + v.array[3] * m.cols[3][1];
	ret.array[2] = v.array[0] * m.cols[0][2] + v.array[1] * m.cols[1][2] + v.array[2] * m.cols[2][2] + v.array[3] * m.cols[3][2];
	return ret;
}
HCC_INTRINSIC vec4f invmulm4x4v4f(mat4x4f m, vec4f v) {
	vec4f ret;
	ret.array[0] = v.array[0] * m.cols[0][0] + v.array[1] * m.cols[1][0] + v.array[2] * m.cols[2][0] + v.array[3] * m.cols[3][0];
	ret.array[1] = v.array[0] * m.cols[0][1] + v.array[1] * m.cols[1][1] + v.array[2] * m.cols[2][1] + v.array[3] * m.cols[3][1];
	ret.array[2] = v.array[0] * m.cols[0][2] + v.array[1] * m.cols[1][2] + v.array[2] * m.cols[2][2] + v.array[3] * m.cols[3][2];
	ret.array[3] = v.array[0] * m.cols[0][3] + v.array[1] * m.cols[1][3] + v.array[2] * m.cols[2][3] + v.array[3] * m.cols[3][3];
	return ret;
}
HCC_INTRINSIC vec4d invmulm4x4v4d(mat4x4d m, vec4d v) {
	vec4d ret;
	ret.array[0] = v.array[0] * m.cols[0][0] + v.array[1] * m.cols[1][0] + v.array[2] * m.cols[2][0] + v.array[3] * m.cols[3][0];
	ret.array[1] = v.array[0] * m.cols[0][1] + v.array[1] * m.cols[1][1] + v.array[2] * m.cols[2][1] + v.array[3] * m.cols[3][1];
	ret.array[2] = v.array[0] * m.cols[0][2] + v.array[1] * m.cols[1][2] + v.array[2] * m.cols[2][2] + v.array[3] * m.cols[3][2];
	ret.array[3] = v.array[0] * m.cols[0][3] + v.array[1] * m.cols[1][3] + v.array[2] * m.cols[2][3] + v.array[3] * m.cols[3][3];
	return ret;
}

//
// returns the transposed matrix of matrix 'm'
HCC_INTRINSIC mat2x2f transposem2x2f(mat2x2f m) {
	mat2x2f ret;
	ret.cols[0][0] = m.cols[0][0];
	ret.cols[1][0] = m.cols[0][1];
	ret.cols[0][1] = m.cols[1][0];
	ret.cols[1][1] = m.cols[1][1];
	return ret;
}
HCC_INTRINSIC mat2x2d transposem2x2d(mat2x2d m) {
	mat2x2d ret;
	ret.cols[0][0] = m.cols[0][0];
	ret.cols[1][0] = m.cols[0][1];
	ret.cols[0][1] = m.cols[1][0];
	ret.cols[1][1] = m.cols[1][1];
	return ret;
}
HCC_INTRINSIC mat3x2f transposem2x3f(mat2x3f m) {
	mat3x2f ret;
	ret.cols[0][0] = m.cols[0][0];
	ret.cols[1][0] = m.cols[0][1];
	ret.cols[2][0] = m.cols[0][2];
	ret.cols[0][1] = m.cols[1][0];
	ret.cols[1][1] = m.cols[1][1];
	ret.cols[2][1] = m.cols[1][2];
	return ret;
}
HCC_INTRINSIC mat3x2d transposem2x3d(mat2x3d m) {
	mat3x2d ret;
	ret.cols[0][0] = m.cols[0][0];
	ret.cols[1][0] = m.cols[0][1];
	ret.cols[2][0] = m.cols[0][2];
	ret.cols[0][1] = m.cols[1][0];
	ret.cols[1][1] = m.cols[1][1];
	ret.cols[2][1] = m.cols[1][2];
	return ret;
}
HCC_INTRINSIC mat4x2f transposem2x4f(mat2x4f m) {
	mat4x2f ret;
	ret.cols[0][0] = m.cols[0][0];
	ret.cols[1][0] = m.cols[0][1];
	ret.cols[2][0] = m.cols[0][2];
	ret.cols[3][0] = m.cols[0][3];
	ret.cols[0][1] = m.cols[1][0];
	ret.cols[1][1] = m.cols[1][1];
	ret.cols[2][1] = m.cols[1][2];
	ret.cols[3][1] = m.cols[1][3];
	return ret;
}
HCC_INTRINSIC mat4x2d transposem2x4d(mat2x4d m) {
	mat4x2d ret;
	ret.cols[0][0] = m.cols[0][0];
	ret.cols[1][0] = m.cols[0][1];
	ret.cols[2][0] = m.cols[0][2];
	ret.cols[3][0] = m.cols[0][3];
	ret.cols[0][1] = m.cols[1][0];
	ret.cols[1][1] = m.cols[1][1];
	ret.cols[2][1] = m.cols[1][2];
	ret.cols[3][1] = m.cols[1][3];
	return ret;
}
HCC_INTRINSIC mat2x3f transposem3x2f(mat3x2f m) {
	mat2x3f ret;
	ret.cols[0][0] = m.cols[0][0];
	ret.cols[1][0] = m.cols[0][1];
	ret.cols[0][1] = m.cols[1][0];
	ret.cols[1][1] = m.cols[1][1];
	ret.cols[0][2] = m.cols[2][0];
	ret.cols[1][2] = m.cols[2][1];
	return ret;
}
HCC_INTRINSIC mat2x3d transposem3x2d(mat3x2d m) {
	mat2x3d ret;
	ret.cols[0][0] = m.cols[0][0];
	ret.cols[1][0] = m.cols[0][1];
	ret.cols[0][1] = m.cols[1][0];
	ret.cols[1][1] = m.cols[1][1];
	ret.cols[0][2] = m.cols[2][0];
	ret.cols[1][2] = m.cols[2][1];
	return ret;
}
HCC_INTRINSIC mat3x3f transposem3x3f(mat3x3f m) {
	mat3x3f ret;
	ret.cols[0][0] = m.cols[0][0];
	ret.cols[1][0] = m.cols[0][1];
	ret.cols[2][0] = m.cols[0][2];
	ret.cols[0][1] = m.cols[1][0];
	ret.cols[1][1] = m.cols[1][1];
	ret.cols[2][1] = m.cols[1][2];
	ret.cols[0][2] = m.cols[2][0];
	ret.cols[1][2] = m.cols[2][1];
	ret.cols[2][2] = m.cols[2][2];
	return ret;
}
HCC_INTRINSIC mat3x3d transposem3x3d(mat3x3d m) {
	mat3x3d ret;
	ret.cols[0][0] = m.cols[0][0];
	ret.cols[1][0] = m.cols[0][1];
	ret.cols[2][0] = m.cols[0][2];
	ret.cols[0][1] = m.cols[1][0];
	ret.cols[1][1] = m.cols[1][1];
	ret.cols[2][1] = m.cols[1][2];
	ret.cols[0][2] = m.cols[2][0];
	ret.cols[1][2] = m.cols[2][1];
	ret.cols[2][2] = m.cols[2][2];
	return ret;
}
HCC_INTRINSIC mat4x3f transposem3x4f(mat3x4f m) {
	mat4x3f ret;
	ret.cols[0][0] = m.cols[0][0];
	ret.cols[1][0] = m.cols[0][1];
	ret.cols[2][0] = m.cols[0][2];
	ret.cols[3][0] = m.cols[0][3];
	ret.cols[0][1] = m.cols[1][0];
	ret.cols[1][1] = m.cols[1][1];
	ret.cols[2][1] = m.cols[1][2];
	ret.cols[3][1] = m.cols[1][3];
	ret.cols[0][2] = m.cols[2][0];
	ret.cols[1][2] = m.cols[2][1];
	ret.cols[2][2] = m.cols[2][2];
	ret.cols[3][2] = m.cols[2][3];
	return ret;
}
HCC_INTRINSIC mat4x3d transposem3x4d(mat3x4d m) {
	mat4x3d ret;
	ret.cols[0][0] = m.cols[0][0];
	ret.cols[1][0] = m.cols[0][1];
	ret.cols[2][0] = m.cols[0][2];
	ret.cols[3][0] = m.cols[0][3];
	ret.cols[0][1] = m.cols[1][0];
	ret.cols[1][1] = m.cols[1][1];
	ret.cols[2][1] = m.cols[1][2];
	ret.cols[3][1] = m.cols[1][3];
	ret.cols[0][2] = m.cols[2][0];
	ret.cols[1][2] = m.cols[2][1];
	ret.cols[2][2] = m.cols[2][2];
	ret.cols[3][2] = m.cols[2][3];
	return ret;
}
HCC_INTRINSIC mat2x4f transposem4x2f(mat4x2f m) {
	mat2x4f ret;
	ret.cols[0][0] = m.cols[0][0];
	ret.cols[1][0] = m.cols[0][1];
	ret.cols[0][1] = m.cols[1][0];
	ret.cols[1][1] = m.cols[1][1];
	ret.cols[0][2] = m.cols[2][0];
	ret.cols[1][2] = m.cols[2][1];
	ret.cols[0][3] = m.cols[3][0];
	ret.cols[1][3] = m.cols[3][1];
	return ret;
}
HCC_INTRINSIC mat2x4d transposem4x2d(mat4x2d m) {
	mat2x4d ret;
	ret.cols[0][0] = m.cols[0][0];
	ret.cols[1][0] = m.cols[0][1];
	ret.cols[0][1] = m.cols[1][0];
	ret.cols[1][1] = m.cols[1][1];
	ret.cols[0][2] = m.cols[2][0];
	ret.cols[1][2] = m.cols[2][1];
	ret.cols[0][3] = m.cols[3][0];
	ret.cols[1][3] = m.cols[3][1];
	return ret;
}
HCC_INTRINSIC mat3x4f transposem4x3f(mat4x3f m) {
	mat3x4f ret;
	ret.cols[0][0] = m.cols[0][0];
	ret.cols[1][0] = m.cols[0][1];
	ret.cols[2][0] = m.cols[0][2];
	ret.cols[0][1] = m.cols[1][0];
	ret.cols[1][1] = m.cols[1][1];
	ret.cols[2][1] = m.cols[1][2];
	ret.cols[0][2] = m.cols[2][0];
	ret.cols[1][2] = m.cols[2][1];
	ret.cols[2][2] = m.cols[2][2];
	ret.cols[0][3] = m.cols[3][0];
	ret.cols[1][3] = m.cols[3][1];
	ret.cols[2][3] = m.cols[3][2];
	return ret;
}
HCC_INTRINSIC mat3x4d transposem4x3d(mat4x3d m) {
	mat3x4d ret;
	ret.cols[0][0] = m.cols[0][0];
	ret.cols[1][0] = m.cols[0][1];
	ret.cols[2][0] = m.cols[0][2];
	ret.cols[0][1] = m.cols[1][0];
	ret.cols[1][1] = m.cols[1][1];
	ret.cols[2][1] = m.cols[1][2];
	ret.cols[0][2] = m.cols[2][0];
	ret.cols[1][2] = m.cols[2][1];
	ret.cols[2][2] = m.cols[2][2];
	ret.cols[0][3] = m.cols[3][0];
	ret.cols[1][3] = m.cols[3][1];
	ret.cols[2][3] = m.cols[3][2];
	return ret;
}
HCC_INTRINSIC mat4x4f transposem4x4f(mat4x4f m) {
	mat4x4f ret;
	ret.cols[0][0] = m.cols[0][0];
	ret.cols[1][0] = m.cols[0][1];
	ret.cols[2][0] = m.cols[0][2];
	ret.cols[3][0] = m.cols[0][3];
	ret.cols[0][1] = m.cols[1][0];
	ret.cols[1][1] = m.cols[1][1];
	ret.cols[2][1] = m.cols[1][2];
	ret.cols[3][1] = m.cols[1][3];
	ret.cols[0][2] = m.cols[2][0];
	ret.cols[1][2] = m.cols[2][1];
	ret.cols[2][2] = m.cols[2][2];
	ret.cols[3][2] = m.cols[2][3];
	ret.cols[0][3] = m.cols[3][0];
	ret.cols[1][3] = m.cols[3][1];
	ret.cols[2][3] = m.cols[3][2];
	ret.cols[3][3] = m.cols[3][3];
	return ret;
}
HCC_INTRINSIC mat4x4d transposem4x4d(mat4x4d m) {
	mat4x4d ret;
	ret.cols[0][0] = m.cols[0][0];
	ret.cols[1][0] = m.cols[0][1];
	ret.cols[2][0] = m.cols[0][2];
	ret.cols[3][0] = m.cols[0][3];
	ret.cols[0][1] = m.cols[1][0];
	ret.cols[1][1] = m.cols[1][1];
	ret.cols[2][1] = m.cols[1][2];
	ret.cols[3][1] = m.cols[1][3];
	ret.cols[0][2] = m.cols[2][0];
	ret.cols[1][2] = m.cols[2][1];
	ret.cols[2][2] = m.cols[2][2];
	ret.cols[3][2] = m.cols[2][3];
	ret.cols[0][3] = m.cols[3][0];
	ret.cols[1][3] = m.cols[3][1];
	ret.cols[2][3] = m.cols[3][2];
	ret.cols[3][3] = m.cols[3][3];
	return ret;
}

//
// returns a matrix from the outer product of vector 'a' and vector 'b'
HCC_INTRINSIC mat2x2f outerproductv2v2f(vec2f c, vec2f r) {
	mat2x2f ret;
	ret.cols[0][0] = c[0] * r[0];
	ret.cols[0][1] = c[0] * r[1];
	ret.cols[1][0] = c[1] * r[0];
	ret.cols[1][1] = c[1] * r[1];
	return ret;
}
HCC_INTRINSIC mat2x2d outerproductv2v2d(vec2d c, vec2d r) {
	mat2x2d ret;
	ret.cols[0][0] = c[0] * r[0];
	ret.cols[0][1] = c[0] * r[1];
	ret.cols[1][0] = c[1] * r[0];
	ret.cols[1][1] = c[1] * r[1];
	return ret;
}
HCC_INTRINSIC mat2x3f outerproductv2v3f(vec2f c, vec3f r) {
	mat2x3f ret;
	ret.cols[0][0] = c[0] * r[0];
	ret.cols[0][1] = c[0] * r[1];
	ret.cols[0][2] = c[0] * r[2];
	ret.cols[1][0] = c[1] * r[0];
	ret.cols[1][1] = c[1] * r[1];
	ret.cols[1][2] = c[1] * r[2];
	return ret;
}
HCC_INTRINSIC mat2x3d outerproductv2v3d(vec2d c, vec3d r) {
	mat2x3d ret;
	ret.cols[0][0] = c[0] * r[0];
	ret.cols[0][1] = c[0] * r[1];
	ret.cols[0][2] = c[0] * r[2];
	ret.cols[1][0] = c[1] * r[0];
	ret.cols[1][1] = c[1] * r[1];
	ret.cols[1][2] = c[1] * r[2];
	return ret;
}
HCC_INTRINSIC mat2x4f outerproductv2v4f(vec2f c, vec4f r) {
	mat2x4f ret;
	ret.cols[0][0] = c[0] * r[0];
	ret.cols[0][1] = c[0] * r[1];
	ret.cols[0][2] = c[0] * r[2];
	ret.cols[0][3] = c[0] * r[3];
	ret.cols[1][0] = c[1] * r[0];
	ret.cols[1][1] = c[1] * r[1];
	ret.cols[1][2] = c[1] * r[2];
	ret.cols[1][3] = c[1] * r[3];
	return ret;
}
HCC_INTRINSIC mat2x4d outerproductv2v4d(vec2d c, vec4d r) {
	mat2x4d ret;
	ret.cols[0][0] = c[0] * r[0];
	ret.cols[0][1] = c[0] * r[1];
	ret.cols[0][2] = c[0] * r[2];
	ret.cols[0][3] = c[0] * r[3];
	ret.cols[1][0] = c[1] * r[0];
	ret.cols[1][1] = c[1] * r[1];
	ret.cols[1][2] = c[1] * r[2];
	ret.cols[1][3] = c[1] * r[3];
	return ret;
}
HCC_INTRINSIC mat3x2f outerproductv3v2f(vec3f c, vec2f r) {
	mat3x2f ret;
	ret.cols[0][0] = c[0] * r[0];
	ret.cols[0][1] = c[0] * r[1];
	ret.cols[1][0] = c[1] * r[0];
	ret.cols[1][1] = c[1] * r[1];
	ret.cols[2][0] = c[2] * r[0];
	ret.cols[2][1] = c[2] * r[1];
	return ret;
}
HCC_INTRINSIC mat3x2d outerproductv3v2d(vec3d c, vec2d r) {
	mat3x2d ret;
	ret.cols[0][0] = c[0] * r[0];
	ret.cols[0][1] = c[0] * r[1];
	ret.cols[1][0] = c[1] * r[0];
	ret.cols[1][1] = c[1] * r[1];
	ret.cols[2][0] = c[2] * r[0];
	ret.cols[2][1] = c[2] * r[1];
	return ret;
}
HCC_INTRINSIC mat3x3f outerproductv3v3f(vec3f c, vec3f r) {
	mat3x3f ret;
	ret.cols[0][0] = c[0] * r[0];
	ret.cols[0][1] = c[0] * r[1];
	ret.cols[0][2] = c[0] * r[2];
	ret.cols[1][0] = c[1] * r[0];
	ret.cols[1][1] = c[1] * r[1];
	ret.cols[1][2] = c[1] * r[2];
	ret.cols[2][0] = c[2] * r[0];
	ret.cols[2][1] = c[2] * r[1];
	ret.cols[2][2] = c[2] * r[2];
	return ret;
}
HCC_INTRINSIC mat3x3d outerproductv3v3d(vec3d c, vec3d r) {
	mat3x3d ret;
	ret.cols[0][0] = c[0] * r[0];
	ret.cols[0][1] = c[0] * r[1];
	ret.cols[0][2] = c[0] * r[2];
	ret.cols[1][0] = c[1] * r[0];
	ret.cols[1][1] = c[1] * r[1];
	ret.cols[1][2] = c[1] * r[2];
	ret.cols[2][0] = c[2] * r[0];
	ret.cols[2][1] = c[2] * r[1];
	ret.cols[2][2] = c[2] * r[2];
	return ret;
}
HCC_INTRINSIC mat3x4f outerproductv3v4f(vec3f c, vec4f r) {
	mat3x4f ret;
	ret.cols[0][0] = c[0] * r[0];
	ret.cols[0][1] = c[0] * r[1];
	ret.cols[0][2] = c[0] * r[2];
	ret.cols[0][3] = c[0] * r[3];
	ret.cols[1][0] = c[1] * r[0];
	ret.cols[1][1] = c[1] * r[1];
	ret.cols[1][2] = c[1] * r[2];
	ret.cols[1][3] = c[1] * r[3];
	ret.cols[2][0] = c[2] * r[0];
	ret.cols[2][1] = c[2] * r[1];
	ret.cols[2][2] = c[2] * r[2];
	ret.cols[2][3] = c[2] * r[3];
	return ret;
}
HCC_INTRINSIC mat3x4d outerproductv3v4d(vec3d c, vec4d r) {
	mat3x4d ret;
	ret.cols[0][0] = c[0] * r[0];
	ret.cols[0][1] = c[0] * r[1];
	ret.cols[0][2] = c[0] * r[2];
	ret.cols[0][3] = c[0] * r[3];
	ret.cols[1][0] = c[1] * r[0];
	ret.cols[1][1] = c[1] * r[1];
	ret.cols[1][2] = c[1] * r[2];
	ret.cols[1][3] = c[1] * r[3];
	ret.cols[2][0] = c[2] * r[0];
	ret.cols[2][1] = c[2] * r[1];
	ret.cols[2][2] = c[2] * r[2];
	ret.cols[2][3] = c[2] * r[3];
	return ret;
}
HCC_INTRINSIC mat4x2f outerproductv4v2f(vec4f c, vec2f r) {
	mat4x2f ret;
	ret.cols[0][0] = c[0] * r[0];
	ret.cols[0][1] = c[0] * r[1];
	ret.cols[1][0] = c[1] * r[0];
	ret.cols[1][1] = c[1] * r[1];
	ret.cols[2][0] = c[2] * r[0];
	ret.cols[2][1] = c[2] * r[1];
	ret.cols[3][0] = c[3] * r[0];
	ret.cols[3][1] = c[3] * r[1];
	return ret;
}
HCC_INTRINSIC mat4x2d outerproductv4v2d(vec4d c, vec2d r) {
	mat4x2d ret;
	ret.cols[0][0] = c[0] * r[0];
	ret.cols[0][1] = c[0] * r[1];
	ret.cols[1][0] = c[1] * r[0];
	ret.cols[1][1] = c[1] * r[1];
	ret.cols[2][0] = c[2] * r[0];
	ret.cols[2][1] = c[2] * r[1];
	ret.cols[3][0] = c[3] * r[0];
	ret.cols[3][1] = c[3] * r[1];
	return ret;
}
HCC_INTRINSIC mat4x3f outerproductv4v3f(vec4f c, vec3f r) {
	mat4x3f ret;
	ret.cols[0][0] = c[0] * r[0];
	ret.cols[0][1] = c[0] * r[1];
	ret.cols[0][2] = c[0] * r[2];
	ret.cols[1][0] = c[1] * r[0];
	ret.cols[1][1] = c[1] * r[1];
	ret.cols[1][2] = c[1] * r[2];
	ret.cols[2][0] = c[2] * r[0];
	ret.cols[2][1] = c[2] * r[1];
	ret.cols[2][2] = c[2] * r[2];
	ret.cols[3][0] = c[3] * r[0];
	ret.cols[3][1] = c[3] * r[1];
	ret.cols[3][2] = c[3] * r[2];
	return ret;
}
HCC_INTRINSIC mat4x3d outerproductv4v3d(vec4d c, vec3d r) {
	mat4x3d ret;
	ret.cols[0][0] = c[0] * r[0];
	ret.cols[0][1] = c[0] * r[1];
	ret.cols[0][2] = c[0] * r[2];
	ret.cols[1][0] = c[1] * r[0];
	ret.cols[1][1] = c[1] * r[1];
	ret.cols[1][2] = c[1] * r[2];
	ret.cols[2][0] = c[2] * r[0];
	ret.cols[2][1] = c[2] * r[1];
	ret.cols[2][2] = c[2] * r[2];
	ret.cols[3][0] = c[3] * r[0];
	ret.cols[3][1] = c[3] * r[1];
	ret.cols[3][2] = c[3] * r[2];
	return ret;
}
HCC_INTRINSIC mat4x4f outerproductv4v4f(vec4f c, vec4f r) {
	mat4x4f ret;
	ret.cols[0][0] = c[0] * r[0];
	ret.cols[0][1] = c[0] * r[1];
	ret.cols[0][2] = c[0] * r[2];
	ret.cols[0][3] = c[0] * r[3];
	ret.cols[1][0] = c[1] * r[0];
	ret.cols[1][1] = c[1] * r[1];
	ret.cols[1][2] = c[1] * r[2];
	ret.cols[1][3] = c[1] * r[3];
	ret.cols[2][0] = c[2] * r[0];
	ret.cols[2][1] = c[2] * r[1];
	ret.cols[2][2] = c[2] * r[2];
	ret.cols[2][3] = c[2] * r[3];
	ret.cols[3][0] = c[3] * r[0];
	ret.cols[3][1] = c[3] * r[1];
	ret.cols[3][2] = c[3] * r[2];
	ret.cols[3][3] = c[3] * r[3];
	return ret;
}
HCC_INTRINSIC mat4x4d outerproductv4v4d(vec4d c, vec4d r) {
	mat4x4d ret;
	ret.cols[0][0] = c[0] * r[0];
	ret.cols[0][1] = c[0] * r[1];
	ret.cols[0][2] = c[0] * r[2];
	ret.cols[0][3] = c[0] * r[3];
	ret.cols[1][0] = c[1] * r[0];
	ret.cols[1][1] = c[1] * r[1];
	ret.cols[1][2] = c[1] * r[2];
	ret.cols[1][3] = c[1] * r[3];
	ret.cols[2][0] = c[2] * r[0];
	ret.cols[2][1] = c[2] * r[1];
	ret.cols[2][2] = c[2] * r[2];
	ret.cols[2][3] = c[2] * r[3];
	ret.cols[3][0] = c[3] * r[0];
	ret.cols[3][1] = c[3] * r[1];
	ret.cols[3][2] = c[3] * r[2];
	ret.cols[3][3] = c[3] * r[3];
	return ret;
}

//
// returns the determinant of matrix 'm'
HCC_INTRINSIC float determinantm2x2f(mat2x2f m) {
	return m.cols[0][0] * m.cols[1][1] - m.cols[1][0] * m.cols[0][1];
}
HCC_INTRINSIC double determinantm2x2d(mat2x2d m) {
	return m.cols[0][0] * m.cols[1][1] - m.cols[1][0] * m.cols[0][1];
}
HCC_INTRINSIC float determinantm3x3f(mat3x3f m) {
	float s[3];
	s[0] = (m.cols[1][1] * m.cols[2][2]) - (m.cols[2][1] * m.cols[1][2]);
	s[1] = (m.cols[1][0] * m.cols[2][2]) - (m.cols[1][2] * m.cols[2][0]);
	s[2] = (m.cols[1][0] * m.cols[2][1]) - (m.cols[1][1] * m.cols[2][0]);
	float det = s[0] - s[1] + s[2];
	return det;
}
HCC_INTRINSIC double determinantm3x3d(mat3x3d m) {
	double s[3];
	s[0] = (m.cols[1][1] * m.cols[2][2]) - (m.cols[2][1] * m.cols[1][2]);
	s[1] = (m.cols[1][0] * m.cols[2][2]) - (m.cols[1][2] * m.cols[2][0]);
	s[2] = (m.cols[1][0] * m.cols[2][1]) - (m.cols[1][1] * m.cols[2][0]);
	double det = s[0] - s[1] + s[2];
	return det;
}
HCC_INTRINSIC float determinantm4x4f(mat4x4f m) {
	float s[6];
	float c[6];

	s[0] = m.cols[0][0]*m.cols[1][1] - m.cols[1][0]*m.cols[0][1];
	s[1] = m.cols[0][0]*m.cols[1][2] - m.cols[1][0]*m.cols[0][2];
	s[2] = m.cols[0][0]*m.cols[1][3] - m.cols[1][0]*m.cols[0][3];
	s[3] = m.cols[0][1]*m.cols[1][2] - m.cols[1][1]*m.cols[0][2];
	s[4] = m.cols[0][1]*m.cols[1][3] - m.cols[1][1]*m.cols[0][3];
	s[5] = m.cols[0][2]*m.cols[1][3] - m.cols[1][2]*m.cols[0][3];

	c[0] = m.cols[2][0]*m.cols[3][1] - m.cols[3][0]*m.cols[2][1];
	c[1] = m.cols[2][0]*m.cols[3][2] - m.cols[3][0]*m.cols[2][2];
	c[2] = m.cols[2][0]*m.cols[3][3] - m.cols[3][0]*m.cols[2][3];
	c[3] = m.cols[2][1]*m.cols[3][2] - m.cols[3][1]*m.cols[2][2];
	c[4] = m.cols[2][1]*m.cols[3][3] - m.cols[3][1]*m.cols[2][3];
	c[5] = m.cols[2][2]*m.cols[3][3] - m.cols[3][2]*m.cols[2][3];

	float det = s[0]*c[5]-s[1]*c[4]+s[2]*c[3]+s[3]*c[2]-s[4]*c[1]+s[5]*c[0];
	return det;
}
HCC_INTRINSIC double determinantm4x4d(mat4x4d m) {
	double s[6];
	double c[6];

	s[0] = m.cols[0][0]*m.cols[1][1] - m.cols[1][0]*m.cols[0][1];
	s[1] = m.cols[0][0]*m.cols[1][2] - m.cols[1][0]*m.cols[0][2];
	s[2] = m.cols[0][0]*m.cols[1][3] - m.cols[1][0]*m.cols[0][3];
	s[3] = m.cols[0][1]*m.cols[1][2] - m.cols[1][1]*m.cols[0][2];
	s[4] = m.cols[0][1]*m.cols[1][3] - m.cols[1][1]*m.cols[0][3];
	s[5] = m.cols[0][2]*m.cols[1][3] - m.cols[1][2]*m.cols[0][3];

	c[0] = m.cols[2][0]*m.cols[3][1] - m.cols[3][0]*m.cols[2][1];
	c[1] = m.cols[2][0]*m.cols[3][2] - m.cols[3][0]*m.cols[2][2];
	c[2] = m.cols[2][0]*m.cols[3][3] - m.cols[3][0]*m.cols[2][3];
	c[3] = m.cols[2][1]*m.cols[3][2] - m.cols[3][1]*m.cols[2][2];
	c[4] = m.cols[2][1]*m.cols[3][3] - m.cols[3][1]*m.cols[2][3];
	c[5] = m.cols[2][2]*m.cols[3][3] - m.cols[3][2]*m.cols[2][3];

	double det = s[0]*c[5]-s[1]*c[4]+s[2]*c[3]+s[3]*c[2]-s[4]*c[1]+s[5]*c[0];
	return det;
}

//
// returns the inverse of matrix 'm'
HCC_INTRINSIC mat2x2f inversem2x2f(mat2x2f m) {
	float inv_det = 1.0 / determinantm2x2f(m);
	mat2x2f ret;
	ret.cols[0][0] = m.cols[1][1] * inv_det;
	ret.cols[0][1] = -m.cols[0][1] * inv_det;
	
	ret.cols[1][0] = -m.cols[1][0] * inv_det;
	ret.cols[1][1] = m.cols[0][0] * inv_det;
	return ret;
}
HCC_INTRINSIC mat2x2d inversem2x2d(mat2x2d m) {
	double inv_det = 1.0 / determinantm2x2d(m);
	mat2x2d ret;
	ret.cols[0][0] = m.cols[1][1] * inv_det;
	ret.cols[0][1] = -m.cols[0][1] * inv_det;
	
	ret.cols[1][0] = -m.cols[1][0] * inv_det;
	ret.cols[1][1] = m.cols[0][0] * inv_det;
	return ret;
}
HCC_INTRINSIC mat3x3f inversem3x3f(mat3x3f m) {
	float s[3];
	s[0] = (m.cols[1][1] * m.cols[2][2]) - (m.cols[2][1] * m.cols[1][2]);
	s[1] = (m.cols[1][0] * m.cols[2][2]) - (m.cols[1][2] * m.cols[2][0]);
	s[2] = (m.cols[1][0] * m.cols[2][1]) - (m.cols[1][1] * m.cols[2][0]);
	float det = s[0] - s[1] + s[2];
	float inv_det = 1.0 / det;
	mat3x3f ret;
	ret.cols[0][0] = s[0] * inv_det;
	ret.cols[0][1] = (m.cols[0][2] * m.cols[2][1] - m.cols[0][1] * m.cols[2][2]) * inv_det;
	ret.cols[0][2] = (m.cols[0][1] * m.cols[1][2] - m.cols[0][2] * m.cols[1][1]) * inv_det;
	
	ret.cols[1][0] = -s[1] * inv_det;
	ret.cols[1][1] = (m.cols[0][0] * m.cols[2][2] - m.cols[0][2] * m.cols[2][0]) * inv_det;
	ret.cols[1][2] = (m.cols[1][0] * m.cols[0][2] - m.cols[0][0] * m.cols[1][2]) * inv_det;
	
	ret.cols[2][0] = s[2] * inv_det;
	ret.cols[2][1] = (m.cols[2][0] * m.cols[0][1] - m.cols[0][0] * m.cols[2][1]) * inv_det;
	ret.cols[2][2] = (m.cols[0][0] * m.cols[1][1] - m.cols[1][0] * m.cols[0][1]) * inv_det;
	return ret;
}
HCC_INTRINSIC mat3x3d inversem3x3d(mat3x3d m) {
	double s[3];
	s[0] = (m.cols[1][1] * m.cols[2][2]) - (m.cols[2][1] * m.cols[1][2]);
	s[1] = (m.cols[1][0] * m.cols[2][2]) - (m.cols[1][2] * m.cols[2][0]);
	s[2] = (m.cols[1][0] * m.cols[2][1]) - (m.cols[1][1] * m.cols[2][0]);
	double det = s[0] - s[1] + s[2];
	double inv_det = 1.0 / det;
	mat3x3d ret;
	ret.cols[0][0] = s[0] * inv_det;
	ret.cols[0][1] = (m.cols[0][2] * m.cols[2][1] - m.cols[0][1] * m.cols[2][2]) * inv_det;
	ret.cols[0][2] = (m.cols[0][1] * m.cols[1][2] - m.cols[0][2] * m.cols[1][1]) * inv_det;
	
	ret.cols[1][0] = -s[1] * inv_det;
	ret.cols[1][1] = (m.cols[0][0] * m.cols[2][2] - m.cols[0][2] * m.cols[2][0]) * inv_det;
	ret.cols[1][2] = (m.cols[1][0] * m.cols[0][2] - m.cols[0][0] * m.cols[1][2]) * inv_det;
	
	ret.cols[2][0] = s[2] * inv_det;
	ret.cols[2][1] = (m.cols[2][0] * m.cols[0][1] - m.cols[0][0] * m.cols[2][1]) * inv_det;
	ret.cols[2][2] = (m.cols[0][0] * m.cols[1][1] - m.cols[1][0] * m.cols[0][1]) * inv_det;
	return ret;
}
HCC_INTRINSIC mat4x4f inversem4x4f(mat4x4f m) {
	float s[6];
	float c[6];

	s[0] = m.cols[0][0]*m.cols[1][1] - m.cols[1][0]*m.cols[0][1];
	s[1] = m.cols[0][0]*m.cols[1][2] - m.cols[1][0]*m.cols[0][2];
	s[2] = m.cols[0][0]*m.cols[1][3] - m.cols[1][0]*m.cols[0][3];
	s[3] = m.cols[0][1]*m.cols[1][2] - m.cols[1][1]*m.cols[0][2];
	s[4] = m.cols[0][1]*m.cols[1][3] - m.cols[1][1]*m.cols[0][3];
	s[5] = m.cols[0][2]*m.cols[1][3] - m.cols[1][2]*m.cols[0][3];

	c[0] = m.cols[2][0]*m.cols[3][1] - m.cols[3][0]*m.cols[2][1];
	c[1] = m.cols[2][0]*m.cols[3][2] - m.cols[3][0]*m.cols[2][2];
	c[2] = m.cols[2][0]*m.cols[3][3] - m.cols[3][0]*m.cols[2][3];
	c[3] = m.cols[2][1]*m.cols[3][2] - m.cols[3][1]*m.cols[2][2];
	c[4] = m.cols[2][1]*m.cols[3][3] - m.cols[3][1]*m.cols[2][3];
	c[5] = m.cols[2][2]*m.cols[3][3] - m.cols[3][2]*m.cols[2][3];

	float det = s[0]*c[5]-s[1]*c[4]+s[2]*c[3]+s[3]*c[2]-s[4]*c[1]+s[5]*c[0];
	float inv_det = 1.0 / det;
	mat4x4f ret;
	ret.cols[0][0] = ( m.cols[1][1] * c[5] - m.cols[1][2] * c[4] + m.cols[1][3] * c[3]) * inv_det;
	ret.cols[0][1] = (-m.cols[0][1] * c[5] + m.cols[0][2] * c[4] - m.cols[0][3] * c[3]) * inv_det;
	ret.cols[0][2] = ( m.cols[3][1] * s[5] - m.cols[3][2] * s[4] + m.cols[3][3] * s[3]) * inv_det;
	ret.cols[0][3] = (-m.cols[2][1] * s[5] + m.cols[2][2] * s[4] - m.cols[2][3] * s[3]) * inv_det;
	
	ret.cols[1][0] = (-m.cols[1][0] * c[5] + m.cols[1][2] * c[2] - m.cols[1][3] * c[1]) * inv_det;
	ret.cols[1][1] = ( m.cols[0][0] * c[5] - m.cols[0][2] * c[2] + m.cols[0][3] * c[1]) * inv_det;
	ret.cols[1][2] = (-m.cols[3][0] * s[5] + m.cols[3][2] * s[2] - m.cols[3][3] * s[1]) * inv_det;
	ret.cols[1][3] = ( m.cols[2][0] * s[5] - m.cols[2][2] * s[2] + m.cols[2][3] * s[1]) * inv_det;
	
	ret.cols[2][0] = ( m.cols[1][0] * c[4] - m.cols[1][1] * c[2] + m.cols[1][3] * c[0]) * inv_det;
	ret.cols[2][1] = (-m.cols[0][0] * c[4] + m.cols[0][1] * c[2] - m.cols[0][3] * c[0]) * inv_det;
	ret.cols[2][2] = ( m.cols[3][0] * s[4] - m.cols[3][1] * s[2] + m.cols[3][3] * s[0]) * inv_det;
	ret.cols[2][3] = (-m.cols[2][0] * s[4] + m.cols[2][1] * s[2] - m.cols[2][3] * s[0]) * inv_det;
	
	ret.cols[3][0] = (-m.cols[1][0] * c[3] + m.cols[1][1] * c[1] - m.cols[1][2] * c[0]) * inv_det;
	ret.cols[3][1] = ( m.cols[0][0] * c[3] - m.cols[0][1] * c[1] + m.cols[0][2] * c[0]) * inv_det;
	ret.cols[3][2] = (-m.cols[3][0] * s[3] + m.cols[3][1] * s[1] - m.cols[3][2] * s[0]) * inv_det;
	ret.cols[3][3] = ( m.cols[2][0] * s[3] - m.cols[2][1] * s[1] + m.cols[2][2] * s[0]) * inv_det;
	return ret;
}
HCC_INTRINSIC mat4x4d inversem4x4d(mat4x4d m) {
	double s[6];
	double c[6];

	s[0] = m.cols[0][0]*m.cols[1][1] - m.cols[1][0]*m.cols[0][1];
	s[1] = m.cols[0][0]*m.cols[1][2] - m.cols[1][0]*m.cols[0][2];
	s[2] = m.cols[0][0]*m.cols[1][3] - m.cols[1][0]*m.cols[0][3];
	s[3] = m.cols[0][1]*m.cols[1][2] - m.cols[1][1]*m.cols[0][2];
	s[4] = m.cols[0][1]*m.cols[1][3] - m.cols[1][1]*m.cols[0][3];
	s[5] = m.cols[0][2]*m.cols[1][3] - m.cols[1][2]*m.cols[0][3];

	c[0] = m.cols[2][0]*m.cols[3][1] - m.cols[3][0]*m.cols[2][1];
	c[1] = m.cols[2][0]*m.cols[3][2] - m.cols[3][0]*m.cols[2][2];
	c[2] = m.cols[2][0]*m.cols[3][3] - m.cols[3][0]*m.cols[2][3];
	c[3] = m.cols[2][1]*m.cols[3][2] - m.cols[3][1]*m.cols[2][2];
	c[4] = m.cols[2][1]*m.cols[3][3] - m.cols[3][1]*m.cols[2][3];
	c[5] = m.cols[2][2]*m.cols[3][3] - m.cols[3][2]*m.cols[2][3];

	double det = s[0]*c[5]-s[1]*c[4]+s[2]*c[3]+s[3]*c[2]-s[4]*c[1]+s[5]*c[0];
	double inv_det = 1.0 / det;
	mat4x4d ret;
	ret.cols[0][0] = ( m.cols[1][1] * c[5] - m.cols[1][2] * c[4] + m.cols[1][3] * c[3]) * inv_det;
	ret.cols[0][1] = (-m.cols[0][1] * c[5] + m.cols[0][2] * c[4] - m.cols[0][3] * c[3]) * inv_det;
	ret.cols[0][2] = ( m.cols[3][1] * s[5] - m.cols[3][2] * s[4] + m.cols[3][3] * s[3]) * inv_det;
	ret.cols[0][3] = (-m.cols[2][1] * s[5] + m.cols[2][2] * s[4] - m.cols[2][3] * s[3]) * inv_det;
	
	ret.cols[1][0] = (-m.cols[1][0] * c[5] + m.cols[1][2] * c[2] - m.cols[1][3] * c[1]) * inv_det;
	ret.cols[1][1] = ( m.cols[0][0] * c[5] - m.cols[0][2] * c[2] + m.cols[0][3] * c[1]) * inv_det;
	ret.cols[1][2] = (-m.cols[3][0] * s[5] + m.cols[3][2] * s[2] - m.cols[3][3] * s[1]) * inv_det;
	ret.cols[1][3] = ( m.cols[2][0] * s[5] - m.cols[2][2] * s[2] + m.cols[2][3] * s[1]) * inv_det;
	
	ret.cols[2][0] = ( m.cols[1][0] * c[4] - m.cols[1][1] * c[2] + m.cols[1][3] * c[0]) * inv_det;
	ret.cols[2][1] = (-m.cols[0][0] * c[4] + m.cols[0][1] * c[2] - m.cols[0][3] * c[0]) * inv_det;
	ret.cols[2][2] = ( m.cols[3][0] * s[4] - m.cols[3][1] * s[2] + m.cols[3][3] * s[0]) * inv_det;
	ret.cols[2][3] = (-m.cols[2][0] * s[4] + m.cols[2][1] * s[2] - m.cols[2][3] * s[0]) * inv_det;
	
	ret.cols[3][0] = (-m.cols[1][0] * c[3] + m.cols[1][1] * c[1] - m.cols[1][2] * c[0]) * inv_det;
	ret.cols[3][1] = ( m.cols[0][0] * c[3] - m.cols[0][1] * c[1] + m.cols[0][2] * c[0]) * inv_det;
	ret.cols[3][2] = (-m.cols[3][0] * s[3] + m.cols[3][1] * s[1] - m.cols[3][2] * s[0]) * inv_det;
	ret.cols[3][3] = ( m.cols[2][0] * s[3] - m.cols[2][1] * s[1] + m.cols[2][2] * s[0]) * inv_det;
	return ret;
}
